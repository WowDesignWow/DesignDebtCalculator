<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¨­è¨ˆæ²»ç†èˆ‡åˆè¦é¢¨éšªè©¦ç®— V17 (140é …è³‡æ–™åº«)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- FontAwesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <!-- Marked.js for Markdown parsing -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background-color: #f0f2f5; }
        .card-shadow { box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04); }
        .gradient-bg { background: linear-gradient(135deg, #0f172a 0%, #334155 100%); }
        
        /* Global Scrollbar Styling */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }

        /* --- Slot Machine Styles --- */
        .slot-machine-wrapper {
            display: inline-flex;
            align-items: baseline;
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            font-weight: 900;
            line-height: 1;
            white-space: nowrap; 
        }
        .slot-digit-window {
            display: inline-block;
            height: 1em;
            overflow: hidden;
            position: relative;
            vertical-align: bottom;
        }
        .slot-strip {
            display: flex;
            flex-direction: column;
            transition-timing-function: cubic-bezier(0.1, 0.75, 0.25, 1);
            transform: translateY(0); 
        }
        .slot-num {
            height: 1em;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* --- Slider Styles --- */
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* --- Markdown Table Styles --- */
        .prose { max-width: none; }
        .prose table { 
            width: 100%; 
            border-collapse: collapse; 
            margin-bottom: 1em; 
            font-size: 11px; 
            table-layout: fixed; 
        }
        .prose th, .prose td { 
            border: 1px solid #e2e8f0; 
            padding: 10px; 
            text-align: left; 
            vertical-align: top;
            width: 20%; 
            word-wrap: break-word; 
            overflow-wrap: break-word;
        }
        .prose th { background-color: #f1f5f9; font-weight: 700; color: #334155; position: sticky; top: 0; }
        .table-container { overflow-x: auto; -webkit-overflow-scrolling: touch; }
        
        .prose h1 { font-size: 1.25em; font-weight: 800; margin-bottom: 0.5em; color: #1e293b; }
        .prose ul { list-style-type: disc; padding-left: 1.2em; margin-top: 0.2em; }
        .prose li { margin-bottom: 0.2em; }
        .prose strong { color: #0f172a; font-weight: 700; }
        .prose code { background-color: #f1f5f9; padding: 2px 4px; border-radius: 4px; color: #ef4444; font-size: 0.9em; }

        /* --- Interactive Hover Styles --- */
        .interactive-element:hover { border-color: #60a5fa; }
        input[type="number"]:hover, select:hover { border-color: #60a5fa; }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

    <div class="bg-white w-full max-w-lg rounded-3xl card-shadow overflow-hidden flex flex-col h-[90vh]">
        
        <!-- App Header -->
        <div class="gradient-bg p-6 text-white text-center flex-shrink-0 relative overflow-hidden">
            <div class="absolute top-0 right-0 p-4 opacity-10"><i class="fas fa-chart-line text-6xl"></i></div>
            <h1 class="text-2xl font-bold mb-1 tracking-wide">è¨­è¨ˆæ²»ç†èˆ‡é¢¨éšªè©¦ç®—</h1>
            <p class="text-slate-300 text-xs uppercase tracking-wider font-semibold">Efficiency Loss + Compliance Risk</p>
        </div>

        <!-- Main Content (Inputs) -->
        <div class="p-6 space-y-5 overflow-y-auto flex-grow bg-slate-50">
            
            <!-- Section 1: Basic Cost -->
            <div class="bg-white rounded-xl border border-slate-200 p-4 shadow-sm">
                <div class="flex items-center text-slate-800 font-bold border-b border-slate-100 pb-2 mb-3">
                    <i class="fas fa-coins text-blue-600 mr-2"></i>
                    <span>åŸºç¤äººåŠ›æˆæœ¬</span>
                </div>
                <div class="space-y-3">
                    <div>
                        <label class="text-xs text-slate-500 font-bold uppercase block mb-1">å¹³å‡æœˆè–ª (TWD)</label>
                        <input type="number" id="salary" value="70000" class="w-full bg-slate-50 border border-slate-300 rounded-lg p-2 font-semibold text-slate-700 focus:ring-2 focus:ring-blue-500 outline-none transition-colors">
                    </div>
                    
                    <!-- Bonus Section -->
                    <div>
                        <label class="text-xs text-slate-500 font-bold uppercase block mb-2">å¹´çµ‚ï¼çé‡‘</label>
                        <div class="space-y-2">
                            <div class="flex space-x-2">
                                <label class="cursor-pointer block flex-1">
                                    <input type="radio" name="bonusType" value="14" id="bonusFixedRadio" class="peer sr-only" checked onchange="toggleBonusInput()">
                                    <div id="fixedBonusBtn" class="interactive-element w-full text-center text-xs py-2 border border-slate-300 rounded-md peer-checked:bg-blue-600 peer-checked:text-white peer-checked:border-blue-600 transition flex items-center justify-center font-medium text-slate-600 bg-white">
                                        å›ºå®š 14 å€‹æœˆ
                                    </div>
                                </label>
                                <label class="cursor-pointer block flex-1">
                                    <input type="radio" name="bonusType" value="12" id="bonusNoneRadio" class="peer sr-only" onchange="toggleBonusInput()">
                                    <div id="noneBonusBtn" class="interactive-element w-full text-center text-xs py-2 border border-slate-300 rounded-md peer-checked:bg-blue-600 peer-checked:text-white peer-checked:border-blue-600 transition flex items-center justify-center font-medium text-slate-600 bg-white">
                                        ç„¡
                                    </div>
                                </label>
                            </div>
                            
                            <!-- Custom Input -->
                            <div class="flex items-center space-x-2">
                                <div class="relative w-full">
                                    <input type="radio" name="bonusType" value="custom" id="bonusCustomRadio" class="peer sr-only" onchange="toggleBonusInput()">
                                    <div id="customBonusWrapper" class="flex w-full rounded-lg border border-slate-300 bg-slate-50 overflow-hidden transition-all cursor-text hover:border-blue-400" onclick="selectCustomRadio()">
                                        <input type="number" id="customBonus" placeholder="è¼¸å…¥è‡ªè¨‚çé‡‘ç¸½é¡" 
                                            class="w-[80%] bg-transparent border-none p-2 pl-3 text-sm font-semibold text-slate-700 focus:outline-none placeholder-slate-400"
                                            onfocus="selectCustomRadio()">
                                        <div class="w-[20%] flex items-center justify-center border-l border-slate-300 bg-slate-100 text-xs text-slate-500 font-medium">
                                            å…ƒ (TWD)
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <p class="text-[10px] text-slate-400 mt-1.5 flex items-start">
                            <i class="fas fa-info-circle mr-1 mt-0.5"></i>
                            <span id="bonusHint">ç³»çµ±æœƒå°‡çé‡‘è‡ªå‹•æ”¤æè‡³æ¯æœˆæœˆè–ªæˆæœ¬ä¸­ã€‚</span>
                        </p>
                    </div>
                </div>
            </div>

            <!-- Section 2: Efficiency Loss -->
            <div class="bg-white rounded-xl border border-slate-200 p-4 shadow-sm relative group">
                <div class="absolute -left-1 top-4 w-1 h-12 bg-orange-400 rounded-r"></div>
                <div class="flex items-center text-slate-800 font-bold border-b border-slate-100 pb-2 mb-3">
                    <i class="fas fa-stopwatch text-orange-500 mr-2"></i>
                    <span>æ²»ç†ç¼ºå¤±ï¼šæ•ˆç‡è€—æ</span>
                </div>
                
                <!-- Designer -->
                <div class="mb-4 pb-4 border-b border-slate-50 last:border-0 last:pb-0">
                    <div class="flex justify-between items-center mb-2">
                        <label class="text-xs font-bold text-slate-700 flex items-center">
                            <i class="fas fa-pen-nib text-slate-400 mr-1.5 text-[10px]"></i>è¨­è¨ˆå¸«
                        </label>
                        <span class="text-[10px] text-orange-600 bg-orange-50 px-2 py-0.5 rounded-full border border-orange-100">ç—›é»ï¼šç„¡ SSOT / ç‹€æ…‹æ··äº‚</span>
                    </div>
                    <div class="flex gap-3">
                        <div class="flex-1">
                            <label class="text-[10px] text-slate-400 block mb-1 uppercase tracking-wide font-semibold">åœ˜éšŠäººæ•¸</label>
                            <div class="flex w-full rounded-lg border border-slate-300 bg-slate-50 overflow-hidden focus-within:ring-2 focus-within:ring-blue-500 focus-within:border-blue-500 transition-colors hover:border-blue-400">
                                <input type="number" id="nDes" value="5" class="w-[80%] bg-transparent border-none p-2 pl-3 text-sm font-bold text-slate-700 focus:outline-none">
                                <div class="w-[20%] flex items-center justify-center border-l border-slate-300 bg-slate-100 text-xs text-slate-500 font-medium">äºº</div>
                            </div>
                        </div>
                        <div class="flex-1">
                            <label class="text-[10px] text-slate-400 block mb-1 uppercase tracking-wide font-semibold">æ¯æ—¥æµªè²»å·¥æ™‚</label>
                            <div class="flex w-full rounded-lg border border-slate-300 bg-slate-50 overflow-hidden focus-within:ring-2 focus-within:ring-blue-500 focus-within:border-blue-500 transition-colors hover:border-blue-400">
                                <input type="number" id="tDes" value="0.75" step="0.25" class="w-[80%] bg-transparent border-none p-2 pl-3 text-sm font-bold text-slate-700 focus:outline-none bg-orange-50/30">
                                <div class="w-[20%] flex items-center justify-center border-l border-slate-300 bg-slate-100 text-xs text-slate-500 font-medium">å°æ™‚</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Developer -->
                <div>
                    <div class="flex justify-between items-center mb-2">
                        <label class="text-xs font-bold text-slate-700 flex items-center">
                            <i class="fas fa-code text-slate-400 mr-1.5 text-[10px]"></i>å·¥ç¨‹å¸«
                        </label>
                        <span class="text-[10px] text-orange-600 bg-orange-50 px-2 py-0.5 rounded-full border border-orange-100">ç—›é»ï¼šé‡è¤‡ Override / çŒœæ¸¬æ¨£å¼</span>
                    </div>
                    <div class="flex gap-3">
                        <div class="flex-1">
                            <label class="text-[10px] text-slate-400 block mb-1 uppercase tracking-wide font-semibold">åœ˜éšŠäººæ•¸</label>
                            <div class="flex w-full rounded-lg border border-slate-300 bg-slate-50 overflow-hidden focus-within:ring-2 focus-within:ring-blue-500 focus-within:border-blue-500 transition-colors hover:border-blue-400">
                                <input type="number" id="nDev" value="3" class="w-[80%] bg-transparent border-none p-2 pl-3 text-sm font-bold text-slate-700 focus:outline-none">
                                <div class="w-[20%] flex items-center justify-center border-l border-slate-300 bg-slate-100 text-xs text-slate-500 font-medium">äºº</div>
                            </div>
                        </div>
                        <div class="flex-1">
                            <label class="text-[10px] text-slate-400 block mb-1 uppercase tracking-wide font-semibold">æ¯æ—¥æµªè²»å·¥æ™‚</label>
                            <div class="flex w-full rounded-lg border border-slate-300 bg-slate-50 overflow-hidden focus-within:ring-2 focus-within:ring-blue-500 focus-within:border-blue-500 transition-colors hover:border-blue-400">
                                <input type="number" id="tDev" value="0.5" step="0.25" class="w-[80%] bg-transparent border-none p-2 pl-3 text-sm font-bold text-slate-700 focus:outline-none bg-orange-50/30">
                                <div class="w-[20%] flex items-center justify-center border-l border-slate-300 bg-slate-100 text-xs text-slate-500 font-medium">å°æ™‚</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Section 3: WCAG Risk -->
            <div class="bg-white rounded-xl border border-red-200 p-4 shadow-sm relative overflow-hidden">
                <div class="absolute -left-1 top-4 w-1 h-12 bg-red-500 rounded-r"></div>
                <div class="flex items-center justify-between border-b border-red-100 pb-2 mb-3">
                    <div class="font-bold text-slate-800 flex items-center">
                        <i class="fas fa-gavel text-red-500 mr-2"></i>
                        <span>æ³•å¾‹èˆ‡åˆè¦é¢¨éšª (WCAG)</span>
                    </div>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" id="wcagToggle" class="sr-only peer" onchange="toggleWcagOptions()">
                        <div class="w-9 h-5 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-red-600 transition-colors"></div>
                    </label>
                </div>
                
                <div id="wcagOptions" class="hidden space-y-3 transition-all">
                    <p class="text-[10px] text-red-500 mb-2">
                        <i class="fas fa-exclamation-triangle"></i> 
                        2025/2026 EAA èˆ‡ ADA å¼·åˆ¶åŸ·è¡Œï¼Œé•è¦å°‡é¢è‡¨é«˜é¡ç½°æ¬¾ã€‚
                    </p>
                    <select id="riskRegion" class="w-full text-sm border-red-200 border rounded-lg p-2.5 bg-red-50 text-slate-700 focus:ring-red-500 transition-colors hover:border-blue-400">
                        <option value="0">è«‹é¸æ“‡ç›®æ¨™å¸‚å ´é¢¨éšª...</option>
                        <option value="600000">ğŸ‡ºğŸ‡¸ ç¾åœ‹ (ADA è¨´è¨Ÿé¢¨éšª ~2è¬ç¾é‡‘)</option>
                        <option value="3300000">ğŸ‡ªğŸ‡º æ­ç›Ÿ (EAA ç½°é°ä¸Šé™é¢¨éšª ~10è¬æ­å…ƒ)</option>
                        <option value="1">ğŸ‡¹ğŸ‡¼ å°ç£ (å…¬éƒ¨é–€æ¨™æ¡ˆè³‡æ ¼å–ªå¤±)</option>
                    </select>
                </div>
                <div id="wcagPlaceholder" class="text-xs text-slate-400 italic">
                    é–‹å•Ÿæ­¤é¸é …ä»¥è©•ä¼°æ½›åœ¨æ³•å¾‹ç½°æ¬¾èˆ‡å¸‚å ´æå¤±ã€‚
                </div>
            </div>

            <!-- Logic Explanation -->
            <div class="bg-white p-5 rounded-xl border border-slate-200 shadow-sm">
                <div class="flex justify-between items-center cursor-pointer group" onclick="toggleLogic()">
                    <h3 class="text-sm font-bold text-slate-700 flex items-center">
                        <i class="fas fa-book-open mr-2 text-slate-400 group-hover:text-blue-500 transition-colors"></i> 
                        è¨ˆç®—é‚è¼¯è©³è§£
                    </h3>
                    <div class="bg-slate-50 p-1 rounded-full border border-slate-200 shadow-sm group-hover:border-blue-300 transition-colors">
                        <i class="fas fa-chevron-down text-slate-400 text-xs transform transition-transform duration-300" id="logicIcon"></i>
                    </div>
                </div>
                
                <div id="logicContent" class="hidden mt-4 space-y-4 text-xs text-slate-600 leading-relaxed border-t border-slate-200 pt-4">
                    <!-- Logic 1 -->
                    <div>
                        <h4 class="font-bold text-slate-800 mb-1 flex items-center">
                            <span class="w-4 h-4 bg-blue-600 text-white rounded-full flex items-center justify-center text-[10px] mr-2">1</span>
                            çœŸå¯¦äººåŠ›æˆæœ¬ (Fully Loaded Cost)
                        </h4>
                        <p class="pl-6 mb-2">å…¬å¼ï¼š<code class="bg-slate-100 px-1 rounded text-slate-800">((æœˆè–ª Ã— 12 + å¹´çµ‚çé‡‘) Ã· 12) Ã— 1.5 Ã· 160å°æ™‚</code></p>
                        <p class="pl-6 text-slate-500 mb-2">
                            <strong>å¹´çµ‚æ”¤æï¼š</strong> å°‡å¹´è–ªèˆ‡é¡å¤–çé‡‘ç¸½é¡æ”¤æè‡³æ¯æœˆï¼Œåæ˜ å…¬å¸å¯¦éš›æ”¯ä»˜çš„æœˆå¹³å‡ç¾é‡‘æµã€‚
                        </p>
                        <p class="pl-6 text-slate-500">
                            <strong>1.5å€ç‡Ÿé‹ä¿‚æ•¸ï¼š</strong> æ¶µè“‹å‹å¥ä¿(ç´„20%)ã€é€€ä¼‘é‡‘(6%)ã€è¾¦å…¬å®¤ç§Ÿé‡‘ã€è»Ÿé«”æˆæ¬Š(Adobe/Figma)ã€ç¡¬é«”æŠ˜èˆŠèˆ‡ç®¡ç†è²»ã€‚
                        </p>
                    </div>

                    <!-- Logic 2 -->
                    <div>
                        <h4 class="font-bold text-slate-800 mb-1 flex items-center">
                            <span class="w-4 h-4 bg-orange-500 text-white rounded-full flex items-center justify-center text-[10px] mr-2">2</span>
                            è²»ç±³æ¨å®šï¼šæ•ˆç‡æµªè²»
                        </h4>
                        <ul class="pl-6 list-disc list-outside space-y-1 text-slate-500">
                            <li><strong>è¨­è¨ˆç«¯ï¼š</strong> åœ¨æ··äº‚çš„æª”æ¡ˆå¤¾ä¸­å°‹æ‰¾ã€é‡è¤‡ç¹ªè£½å·²å­˜åœ¨çš„æŒ‰éˆ•ã€è™•ç†ç‹€æ…‹ä¸ä¸€è‡´ã€‚</li>
                            <li><strong>é–‹ç™¼ç«¯ï¼š</strong> æ¸¬é‡åƒç´ (Pixel-peeping)ã€çŒœæ¸¬è¨­è¨ˆæ„åœ–ã€æ’°å¯«é‡è¤‡çš„ CSS Overrideã€‚</li>
                        </ul>
                    </div>

                    <!-- Logic 3 -->
                    <div>
                        <h4 class="font-bold text-slate-800 mb-1 flex items-center">
                            <span class="w-4 h-4 bg-red-500 text-white rounded-full flex items-center justify-center text-[10px] mr-2">3</span>
                            é¢¨éšªä¼°å€¼ (Risk Assessment)
                        </h4>
                        <p class="pl-6 text-slate-500">
                            <strong>åˆè¦é¢¨éšªï¼š</strong> ä¾æ“šåœ‹éš›è¨´è¨Ÿæ¡ˆä¾‹ï¼ˆADAï¼‰èˆ‡ç½°æ¬¾ä¸Šé™ï¼ˆEAAï¼‰è¨­å®šçš„æ½›åœ¨é¢¨éšªæ•å£ã€‚é€™ä¸¦éå›ºå®šæˆæœ¬ï¼Œè€Œæ˜¯ã€Œä¸è™•ç†å°±æœƒé¢è‡¨ã€çš„é æœŸæå¤±ã€‚
                        </p>
                    </div>
                </div>
            </div>

        </div>

        <!-- Footer / Action -->
        <div class="p-5 border-t border-slate-200 bg-white z-10">
            <button onclick="calculate()" class="w-full bg-slate-800 hover:bg-slate-700 text-white font-bold py-4 px-4 rounded-xl shadow-lg transition-all flex items-center justify-center group">
                <span>è¨ˆç®—ç¸½é«”ç‡Ÿé‹è¡æ“Š</span>
                <i class="fas fa-arrow-right ml-2 group-hover:translate-x-1 transition-transform"></i>
            </button>
        </div>
    </div>

    <!-- RESULT MODAL (Popup) -->
    <div id="resultModal" class="fixed inset-0 bg-slate-900/80 flex items-center justify-center z-50 hidden backdrop-blur-sm transition-opacity opacity-0 p-5">
        <div class="bg-white w-full max-w-2xl rounded-3xl p-6 shadow-2xl transform scale-95 transition-transform duration-300 max-h-[90vh] overflow-y-auto relative" id="modalContent">
            
            <!-- Modal Header -->
            <div class="flex justify-between items-start mb-4">
                <div>
                    <h2 class="text-slate-500 text-xs font-bold uppercase tracking-widest">å¹´åº¦é ä¼°ç¸½è¡æ“Š</h2>
                    <p class="text-[10px] text-slate-400">æ•ˆç‡è€—æ (OpEx) + æ½›åœ¨åˆè¦é¢¨éšª (Risk)</p>
                </div>
                <button onclick="closeModal()" class="text-slate-400 hover:text-slate-600"><i class="fas fa-times text-xl"></i></button>
            </div>

            <!-- SLOT MACHINE RESULT (Red + Negative) with "Pre-text" -->
            <div class="text-[40px] font-black text-red-600 mb-8 tracking-tight flex items-center justify-center flex-wrap" id="finalResultContainer">
                -$0
            </div>

            <!-- Opportunity Cost Slider Section -->
            <div class="mb-6 relative group">
                <div class="absolute inset-0 bg-blue-50 rounded-xl transform -rotate-1 opacity-50"></div>
                <div class="relative bg-white border border-blue-100 rounded-xl p-4 shadow-sm overflow-hidden">
                    
                    <!-- Slider Header with Dice -->
                    <div class="flex justify-between items-center mb-3">
                        <h3 class="text-xs font-bold text-blue-800 uppercase tracking-wide flex items-center">
                            <i class="fas fa-search-dollar mr-1.5"></i> é€™ç­†éŒ¢åŸæœ¬å¯ä»¥æ‹¿ä¾†...
                        </h3>
                        <div class="flex items-center">
                            <!-- Dice Button -->
                            <button onclick="refreshOpportunities()" class="p-1.5 rounded-lg hover:bg-blue-100 text-blue-600 transition-colors mr-2 cursor-pointer group" title="éš¨æ©Ÿæ›ç®—">
                                <i class="fas fa-dice text-lg group-hover:scale-110 transition-transform"></i>
                            </button>
                            <!-- Vertical Divider -->
                            <div class="h-4 w-px bg-slate-300 mr-2"></div>
                            <!-- Slide Text -->
                            <div class="text-blue-300 text-xs flex items-center">æ»‘å‹•æŸ¥çœ‹</div>
                        </div>
                    </div>
                    
                    <!-- Wrapper for slider + fade -->
                    <div class="relative">
                        <!-- Scrollable Container -->
                        <div class="flex overflow-x-auto hide-scrollbar gap-3 pb-2 snap-x snap-mandatory items-stretch" id="opportunitySlider">
                            <!-- Items will be injected by JS -->
                        </div>
                        <!-- Fade Overlay on Right -->
                        <div id="sliderFadeOverlay" class="absolute right-0 top-0 bottom-0 w-16 bg-gradient-to-l from-white via-white/80 to-transparent pointer-events-none transition-opacity duration-300"></div>
                    </div>
                </div>
            </div>
            
            <!-- Breakdown & Markdown Details -->
            <div class="space-y-3 mb-6 border-t border-slate-100 pt-4">
                <h4 class="text-[10px] font-bold text-slate-400 uppercase">æå¤±ç´°é …</h4>
                <!-- Efficiency -->
                <div class="bg-slate-50 rounded-lg p-3">
                    <div class="flex justify-between items-center text-xs cursor-pointer" onclick="toggleEfficiencyDetails()">
                        <div class="flex items-center text-slate-700 font-bold">
                            <i class="fas fa-hourglass-half text-orange-400 w-5 text-center mr-2"></i>æ•ˆç‡æµªè²»
                        </div>
                        <div class="flex items-center">
                            <span class="font-bold text-slate-700 mr-2" id="efficiencyResult">$0</span>
                            <i class="fas fa-chevron-down text-slate-400 transition-transform" id="effDetailsIcon"></i>
                        </div>
                    </div>
                    
                    <!-- Dynamic Markdown Content Container -->
                    <div id="efficiencyDetailsContent" class="hidden mt-3 border-t border-slate-200">
                        <div class="max-h-[300px] overflow-y-auto p-3 text-xs text-slate-600 bg-slate-50/50 rounded-b-lg">
                            <div class="table-container prose prose-sm max-w-none">
                                <!-- Content injected by JS -->
                                è¼‰å…¥èªªæ˜ä¸­...
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Risk -->
                <div id="riskBreakdown" class="hidden flex justify-between items-center text-xs p-3">
                    <div class="flex items-center text-slate-600">
                        <i class="fas fa-gavel text-red-400 w-5 text-center mr-2"></i>åˆè¦é¢¨éšª
                    </div>
                    <div class="font-bold text-red-600" id="riskResult">$0</div>
                </div>
            </div>

            <button onclick="closeModal()" class="w-full bg-slate-900 text-white font-bold py-3.5 rounded-xl hover:bg-slate-800 transition shadow-lg">
                é—œé–‰ä¸¦èª¿æ•´ç­–ç•¥
            </button>
        </div>
    </div>

    <script>
        // --- 140 OPPORTUNITY ITEMS POOL ---
        // Categories: HR, Tech, Office, Life, Biz
        const poolItems = [
            // HR & Hiring (20)
            { title: 'å¢è˜è³‡æ·±å·¥ç¨‹å¸«', unit: 'äºº', icon: 'fa-user-plus', color: 'blue', price: (b) => b * 1.1 },
            { title: 'å¢è˜è³‡æ·±è¨­è¨ˆå¸«', unit: 'äºº', icon: 'fa-pen-nib', color: 'purple', price: (b) => b * 0.9 },
            { title: 'å¢è˜å°ˆæ¡ˆç¶“ç† (PM)', unit: 'äºº', icon: 'fa-tasks', color: 'indigo', price: (b) => b * 1.0 },
            { title: 'å¢è˜ QA å·¥ç¨‹å¸«', unit: 'äºº', icon: 'fa-bug', color: 'teal', price: (b) => b * 0.8 },
            { title: 'å¢è˜å¯¦ç¿’ç”Ÿ (ä¸€å¹´)', unit: 'äºº', icon: 'fa-graduation-cap', color: 'green', price: 360000 },
            { title: 'é«˜éšçµé ­æœå‹™è²»', unit: 'äºº', icon: 'fa-user-tie', color: 'slate', price: 300000 },
            { title: 'æ–°é€²äººå“¡ç°½ç´„é‡‘', unit: 'äºº', icon: 'fa-file-signature', color: 'yellow', price: 100000 },
            { title: 'ç•™ä»»çé‡‘ (Retention)', unit: 'äºº', icon: 'fa-hand-holding-usd', color: 'orange', price: 150000 },
            { title: 'å¹´åº¦èª¿è–ªé ç®—', unit: 'äºº', icon: 'fa-chart-line', color: 'emerald', price: 60000 },
            { title: 'å“¡å·¥æ¨è–¦çé‡‘', unit: 'äºº', icon: 'fa-users', color: 'cyan', price: 30000 },
            { title: 'å¤–éƒ¨æŠ€è¡“é¡§å•', unit: 'æœˆ', icon: 'fa-chalkboard-teacher', color: 'violet', price: 100000 },
            { title: 'æ•æ·æ•™ç·´ (Agile Coach)', unit: 'å¤©', icon: 'fa-stopwatch', color: 'rose', price: 20000 },
            { title: 'è³‡æ·±æ¶æ§‹å¸«è«®è©¢', unit: 'å°æ™‚', icon: 'fa-sitemap', color: 'slate', price: 8000 },
            { title: 'UI/UX å°ˆå®¶å¯©æŸ¥', unit: 'æ¬¡', icon: 'fa-search', color: 'pink', price: 50000 },
            { title: 'ä½¿ç”¨è€…æ¸¬è©¦å—è¨ªè€…', unit: 'äºº', icon: 'fa-comment-dots', color: 'lime', price: 2000 },
            { title: 'å“¡å·¥æ•™è‚²è¨“ç·´è£œåŠ©', unit: 'äºº', icon: 'fa-book-reader', color: 'blue', price: 20000 },
            { title: 'å…¨é«”å“¡å·¥å¥æª¢', unit: 'å ´', icon: 'fa-heartbeat', color: 'red', price: 150000 }, // Est 20 ppl
            { title: 'åœ˜é«”ä¿éšªè²»', unit: 'å¹´', icon: 'fa-shield-alt', color: 'sky', price: 100000 },
            { title: 'éƒ¨é–€å­£çé‡‘', unit: 'å­£', icon: 'fa-trophy', color: 'amber', price: 200000 },
            { title: 'è³‡é£è²» (é¢¨éšªé å‚™)', unit: 'äºº', icon: 'fa-door-open', color: 'gray', price: 100000 },

            // Hardware & Tech (25)
            { title: 'é ‚è¦ MacBook Pro', unit: 'å°', icon: 'fa-laptop', color: 'gray', price: 80000 },
            { title: 'MacBook Air', unit: 'å°', icon: 'fa-laptop', color: 'slate', price: 35000 },
            { title: 'Dell XPS é–‹ç™¼æ©Ÿ', unit: 'å°', icon: 'fa-laptop-code', color: 'zinc', price: 60000 },
            { title: 'ThinkPad X1', unit: 'å°', icon: 'fa-laptop', color: 'neutral', price: 55000 },
            { title: 'iMac 24å‹', unit: 'å°', icon: 'fa-desktop', color: 'orange', price: 45000 },
            { title: 'Mac Studio', unit: 'å°', icon: 'fa-microchip', color: 'stone', price: 70000 },
            { title: 'Apple Pro Display XDR', unit: 'å°', icon: 'fa-tv', color: 'black', price: 160000 },
            { title: '4K å°ˆæ¥­è¢å¹•', unit: 'å°', icon: 'fa-tv', color: 'blue', price: 15000 },
            { title: '34å‹ æ›²é¢è¢å¹•', unit: 'å°', icon: 'fa-tv', color: 'indigo', price: 25000 },
            { title: 'iPad Pro (æ¸¬è©¦æ©Ÿ)', unit: 'å°', icon: 'fa-tablet-alt', color: 'purple', price: 30000 },
            { title: 'iPhone 15 Pro (æ¸¬è©¦æ©Ÿ)', unit: 'å°', icon: 'fa-mobile-alt', color: 'green', price: 40000 },
            { title: 'Android æ——è‰¦æ©Ÿ (æ¸¬è©¦)', unit: 'å°', icon: 'fa-robot', color: 'lime', price: 30000 },
            { title: 'HHKB æ©Ÿæ¢°éµç›¤', unit: 'æŠŠ', icon: 'fa-keyboard', color: 'slate', price: 10000 },
            { title: 'Logitech MX Master', unit: 'é¡†', icon: 'fa-mouse', color: 'gray', price: 4000 },
            { title: 'é™å™ªè€³æ©Ÿ (Sony/Bose)', unit: 'å‰¯', icon: 'fa-headphones', color: 'sky', price: 10000 },
            { title: 'äººé«”å·¥å­¸æ»‘é¼ ', unit: 'é¡†', icon: 'fa-mouse', color: 'teal', price: 3000 },
            { title: 'Wacom ç¹ªåœ–æ¿', unit: 'å¡Š', icon: 'fa-pencil-alt', color: 'pink', price: 12000 },
            { title: 'NAS å„²å­˜è¨­å‚™', unit: 'å°', icon: 'fa-hdd', color: 'amber', price: 20000 },
            { title: 'GPU ç®—åŠ›ç§Ÿè³ƒ (A100)', unit: 'æœˆ', icon: 'fa-memory', color: 'green', price: 40000 },
            { title: 'VR é ­ç›” (Vision Pro)', unit: 'å°', icon: 'fa-vr-cardboard', color: 'fuchsia', price: 120000 },
            { title: 'æ¸¬è©¦ç”¨ä¼ºæœå™¨', unit: 'å°', icon: 'fa-server', color: 'blue', price: 50000 },
            { title: 'æ©Ÿæˆ¿å†·æ°£é›»è²»', unit: 'æœˆ', icon: 'fa-snowflake', color: 'cyan', price: 15000 },
            { title: 'Raspberry Pi å¢é›†', unit: 'çµ„', icon: 'fa-microchip', color: 'red', price: 10000 },
            { title: '3D å°è¡¨æ©Ÿ', unit: 'å°', icon: 'fa-print', color: 'orange', price: 25000 },
            { title: 'æœƒè­°å®¤è¦–è¨Šè¨­å‚™', unit: 'çµ„', icon: 'fa-video', color: 'slate', price: 80000 },

            // SaaS & Software (25)
            { title: 'Figma ä¼æ¥­å¹´è²»', unit: 'å¹´', icon: 'fa-file-invoice-dollar', color: 'purple', price: 150000 },
            { title: 'Adobe CC å…¨å¥—', unit: 'å¹´', icon: 'fa-palette', color: 'red', price: 30000 },
            { title: 'Github Copilot åœ˜éšŠ', unit: 'å¹´', icon: 'fa-robot', color: 'slate', price: 60000 },
            { title: 'ChatGPT Plus (å…¨å“¡)', unit: 'å¹´', icon: 'fa-comment-alt', color: 'green', price: 80000 },
            { title: 'AWS é›²ç«¯å¸³å–®', unit: 'æœˆ', icon: 'fa-cloud', color: 'orange', price: 30000 },
            { title: 'GCP é›²ç«¯å¸³å–®', unit: 'æœˆ', icon: 'fa-cloud', color: 'blue', price: 30000 },
            { title: 'Azure é›²ç«¯å¸³å–®', unit: 'æœˆ', icon: 'fa-cloud', color: 'sky', price: 30000 },
            { title: 'Vercel Pro è¨‚é–±', unit: 'å¹´', icon: 'fa-server', color: 'black', price: 20000 },
            { title: 'Slack Business', unit: 'å¹´', icon: 'fa-comments', color: 'fuchsia', price: 50000 },
            { title: 'Zoom Pro å¸³è™Ÿ', unit: 'å¹´', icon: 'fa-video', color: 'blue', price: 15000 },
            { title: 'Notion Team Plan', unit: 'å¹´', icon: 'fa-book', color: 'stone', price: 30000 },
            { title: 'Jira/Confluence', unit: 'å¹´', icon: 'fa-tasks', color: 'blue', price: 40000 },
            { title: 'Linear å°ˆæ¡ˆç®¡ç†', unit: 'å¹´', icon: 'fa-list-check', color: 'indigo', price: 30000 },
            { title: 'Asana é€²éšç‰ˆ', unit: 'å¹´', icon: 'fa-check-circle', color: 'rose', price: 35000 },
            { title: 'Miro å”ä½œç™½æ¿', unit: 'å¹´', icon: 'fa-border-all', color: 'yellow', price: 25000 },
            { title: 'Typeform é€²éšç‰ˆ', unit: 'å¹´', icon: 'fa-wpforms', color: 'teal', price: 15000 },
            { title: 'Webflow ç¶²ç«™è¨—ç®¡', unit: 'å¹´', icon: 'fa-globe', color: 'blue', price: 12000 },
            { title: 'Google Workspace', unit: 'å¹´', icon: 'fa-envelope', color: 'red', price: 80000 },
            { title: 'Microsoft 365', unit: 'å¹´', icon: 'fa-file-word', color: 'blue', price: 80000 },
            { title: '1Password ä¼æ¥­ç‰ˆ', unit: 'å¹´', icon: 'fa-key', color: 'slate', price: 20000 },
            { title: 'Sentry éŒ¯èª¤ç›£æ§', unit: 'å¹´', icon: 'fa-bug', color: 'violet', price: 10000 },
            { title: 'Datadog ç›£æ§', unit: 'æœˆ', icon: 'fa-chart-area', color: 'purple', price: 15000 },
            { title: 'Intercom å®¢æœç³»çµ±', unit: 'æœˆ', icon: 'fa-headset', color: 'blue', price: 10000 },
            { title: 'Zendesk å®¢æœç³»çµ±', unit: 'æœˆ', icon: 'fa-ticket-alt', color: 'green', price: 8000 },
            { title: 'Salesforce æˆæ¬Š', unit: 'äºº/å¹´', icon: 'fa-cloud', color: 'sky', price: 50000 },

            // Office & Admin (25)
            { title: 'Herman Miller æ¤…', unit: 'å¼µ', icon: 'fa-chair', color: 'black', price: 45000 },
            { title: 'å‡é™æ¡Œ (é›»å‹•)', unit: 'å¼µ', icon: 'fa-arrows-alt-v', color: 'stone', price: 15000 },
            { title: 'ä¿¡ç¾©å€è¾¦å…¬å®¤ç§Ÿé‡‘', unit: 'åª/æœˆ', icon: 'fa-building', color: 'slate', price: 3500 },
            { title: 'å…§æ¹–å•†è¾¦ç§Ÿé‡‘', unit: 'åª/æœˆ', icon: 'fa-building', color: 'zinc', price: 1800 },
            { title: 'å…±äº«è¾¦å…¬å®¤å¸­ä½', unit: 'äºº/æœˆ', icon: 'fa-chair', color: 'orange', price: 8000 },
            { title: 'è¾¦å…¬å®¤æ¸…æ½”è²»', unit: 'æœˆ', icon: 'fa-broom', color: 'teal', price: 12000 },
            { title: 'è¾¦å…¬å®¤é›»è²»', unit: 'æœˆ', icon: 'fa-bolt', color: 'yellow', price: 20000 },
            { title: 'å•†æ¥­å…‰çº–ç¶²è·¯', unit: 'æœˆ', icon: 'fa-wifi', color: 'blue', price: 3000 },
            { title: 'Nespresso è† å›Š', unit: 'å¹´', icon: 'fa-coffee', color: 'amber', price: 20000 },
            { title: 'æ˜Ÿå·´å…‹å’–å•¡è±†', unit: 'å¹´', icon: 'fa-mug-hot', color: 'green', price: 15000 },
            { title: 'è¾¦å…¬å®¤é›¶é£Ÿæ«ƒ', unit: 'æœˆ', icon: 'fa-cookie-bite', color: 'orange', price: 10000 },
            { title: 'å•¤é…’/é£²æ–™åº«å­˜', unit: 'æœˆ', icon: 'fa-beer', color: 'yellow', price: 8000 },
            { title: 'Dyson å¸å¡µå™¨', unit: 'å°', icon: 'fa-quidditch', color: 'purple', price: 20000 },
            { title: 'Dyson ç©ºæ°£æ¸…æ·¨æ©Ÿ', unit: 'å°', icon: 'fa-wind', color: 'slate', price: 25000 },
            { title: 'å…æ²»é¦¬æ¡¶åº§', unit: 'å€‹', icon: 'fa-toilet', color: 'white', price: 15000 },
            { title: 'åŠ å¤§ç™½æ¿ç‰†', unit: 'é¢', icon: 'fa-chalkboard', color: 'slate', price: 10000 },
            { title: 'æŠ•å½±æ©Ÿ (é«˜æµæ˜)', unit: 'å°', icon: 'fa-video', color: 'gray', price: 30000 },
            { title: 'ç¢ç´™æ©Ÿ (å•†ç”¨)', unit: 'å°', icon: 'fa-trash', color: 'black', price: 5000 },
            { title: 'é£²æ°´æ©Ÿä¿é¤Šè²»', unit: 'å¹´', icon: 'fa-tint', color: 'blue', price: 6000 },
            { title: 'è¾¦å…¬å®¤ç›†æ ½ç§Ÿè³ƒ', unit: 'æœˆ', icon: 'fa-seedling', color: 'green', price: 3000 },
            { title: 'é›œèªŒè¨‚é–± (è¨­è¨ˆ)', unit: 'å¹´', icon: 'fa-book-open', color: 'pink', price: 5000 },
            { title: 'è¨ˆç¨‹è»Šè²»å ±å¸³', unit: 'æœˆ', icon: 'fa-taxi', color: 'yellow', price: 10000 },
            { title: 'å¿«éç‰©æµè²»', unit: 'æœˆ', icon: 'fa-truck', color: 'slate', price: 5000 },
            { title: 'æ–‡å…·ç”¨å“æ¡è³¼', unit: 'å­£', icon: 'fa-pencil-ruler', color: 'indigo', price: 8000 },
            { title: 'å°è¡¨æ©Ÿç§Ÿè³ƒ', unit: 'æœˆ', icon: 'fa-print', color: 'gray', price: 3000 },

            // Lifestyle, Marketing & Misc (45)
            { title: 'ç±³å…¶æ—éƒ¨é–€èšé¤', unit: 'å ´', icon: 'fa-utensils', color: 'red', price: 60000 },
            { title: 'æ¯é€±äº”ä¸‹åˆèŒ¶', unit: 'å¹´', icon: 'fa-pizza-slice', color: 'orange', price: 100000 },
            { title: 'æ²–ç¹©å“¡å·¥æ—…éŠ', unit: 'äºº', icon: 'fa-umbrella-beach', color: 'cyan', price: 30000 },
            { title: 'åŒ—æµ·é“æ»‘é›ªåœ˜', unit: 'äºº', icon: 'fa-snowflake', color: 'blue', price: 50000 },
            { title: 'åœ‹å…§è±ªè¯éœ²ç‡Ÿ', unit: 'äºº', icon: 'fa-campground', color: 'green', price: 10000 },
            { title: 'äº”æ˜Ÿç´šé£¯åº—ä½å®¿', unit: 'æ™š', icon: 'fa-bed', color: 'slate', price: 12000 },
            { title: 'Tesla Model 3', unit: 'è¼›', icon: 'fa-car', color: 'red', price: 1750000 },
            { title: 'Gogoro æ©Ÿè»Š', unit: 'å°', icon: 'fa-motorcycle', color: 'gray', price: 80000 },
            { title: 'å•†å‹™è‰™æ©Ÿç¥¨ (ç¾è¥¿)', unit: 'å¼µ', icon: 'fa-plane', color: 'blue', price: 120000 },
            { title: 'é«˜éµå•†å‹™è‰™ (å¹´)', unit: 'äºº', icon: 'fa-subway', color: 'orange', price: 50000 },
            { title: 'å¥èº«æˆ¿è£œåŠ©', unit: 'äºº/å¹´', icon: 'fa-dumbbell', color: 'slate', price: 12000 },
            { title: 'æŒ‰æ‘©æœå‹™ (åˆ°åºœ)', unit: 'æ¬¡', icon: 'fa-spa', color: 'pink', price: 2000 },
            { title: 'Netflix è¨‚é–± (å¹´)', unit: 'ä»½', icon: 'fa-film', color: 'red', price: 3500 },
            { title: 'Spotify è¨‚é–± (å¹´)', unit: 'ä»½', icon: 'fa-music', color: 'green', price: 2000 },
            { title: 'PS5 éŠæˆ²ä¸»æ©Ÿ', unit: 'å°', icon: 'fa-gamepad', color: 'blue', price: 18000 },
            { title: 'Switch ä¸»æ©Ÿ', unit: 'å°', icon: 'fa-gamepad', color: 'red', price: 10000 },
            { title: 'Steam éŠæˆ²è³¼ç‰©é‡‘', unit: 'ä»½', icon: 'fa-gamepad', color: 'black', price: 5000 },
            { title: 'å¥ˆè‰¯ç¾æ™ºç‰ˆç•«', unit: 'å¹…', icon: 'fa-palette', color: 'yellow', price: 200000 },
            { title: 'BE@RBRICK å…¬ä»”', unit: 'éš»', icon: 'fa-robot', color: 'white', price: 20000 },
            { title: 'å‹åŠ›å£«æ‰‹éŒ¶', unit: 'æ”¯', icon: 'fa-clock', color: 'emerald', price: 350000 },
            { title: 'æ„›é¦¬ä»•æŸé‡‘åŒ…', unit: 'å€‹', icon: 'fa-shopping-bag', color: 'orange', price: 400000 },
            { title: 'FB/IG å»£å‘ŠæŠ•æ”¾', unit: 'å¤©', icon: 'fa-ad', color: 'blue', price: 5000 },
            { title: 'Google é—œéµå­—å»£å‘Š', unit: 'å¤©', icon: 'fa-search', color: 'green', price: 5000 },
            { title: 'KOL æ¥­é…åˆä½œ', unit: 'æ¬¡', icon: 'fa-bullhorn', color: 'pink', price: 50000 },
            { title: 'æ–°èç¨¿ç™¼å¸ƒ', unit: 'ç¯‡', icon: 'fa-newspaper', color: 'slate', price: 30000 },
            { title: 'å±•è¦½æ”¤ä½ç§Ÿé‡‘', unit: 'å ´', icon: 'fa-store', color: 'indigo', price: 100000 },
            { title: 'æ´»å‹•å ´åœ°ç§Ÿå€Ÿ', unit: 'å¤©', icon: 'fa-building', color: 'gray', price: 20000 },
            { title: 'å°ˆæ¥­æ”å½±å¸«', unit: 'å¤©', icon: 'fa-camera', color: 'black', price: 15000 },
            { title: 'å½¢è±¡å½±ç‰‡è£½ä½œ', unit: 'æ”¯', icon: 'fa-video', color: 'red', price: 150000 },
            { title: 'Logo è¨­è¨ˆè²»', unit: 'å¼', icon: 'fa-drafting-compass', color: 'purple', price: 50000 },
            { title: 'å¾‹å¸«è«®è©¢è²»', unit: 'å°æ™‚', icon: 'fa-gavel', color: 'slate', price: 6000 },
            { title: 'å•†æ¨™è¨»å†Šè²»', unit: 'ä»¶', icon: 'fa-registered', color: 'blue', price: 10000 },
            { title: 'æœƒè¨ˆå¸«ç°½è­‰è²»', unit: 'å¹´', icon: 'fa-file-contract', color: 'green', price: 50000 },
            { title: 'å°ˆåˆ©ç”³è«‹è²»', unit: 'ä»¶', icon: 'fa-certificate', color: 'yellow', price: 60000 },
            { title: 'GDPR åˆè¦é¡§å•', unit: 'æ¬¡', icon: 'fa-shield-alt', color: 'blue', price: 100000 },
            { title: 'ISO èªè­‰è¼”å°', unit: 'æ¡ˆ', icon: 'fa-stamp', color: 'slate', price: 200000 },
            { title: 'è³‡å®‰æ»²é€æ¸¬è©¦', unit: 'æ¬¡', icon: 'fa-user-secret', color: 'black', price: 150000 },
            { title: 'ä¼ºæœå™¨å£“åŠ›æ¸¬è©¦', unit: 'æ¬¡', icon: 'fa-tachometer-alt', color: 'red', price: 50000 },
            { title: 'ä½¿ç”¨è€…è¨ªè«‡è²»', unit: 'å ´', icon: 'fa-comments', color: 'teal', price: 3000 },
            { title: 'å¸‚å ´èª¿æŸ¥å ±å‘Š', unit: 'ä»½', icon: 'fa-chart-pie', color: 'indigo', price: 50000 },
            { title: 'ç«¶å“åˆ†æå ±å‘Š', unit: 'ä»½', icon: 'fa-search-dollar', color: 'green', price: 30000 },
            { title: 'æŠ€è¡“å¤§æœƒé–€ç¥¨', unit: 'å¼µ', icon: 'fa-ticket-alt', color: 'purple', price: 8000 },
            { title: 'ç·šä¸Šèª²ç¨‹è¨‚é–±', unit: 'å¹´', icon: 'fa-laptop-code', color: 'blue', price: 5000 },
            { title: 'æŠ€è¡“æ›¸ç±æ¡è³¼', unit: 'æ‰¹', icon: 'fa-book', color: 'orange', price: 10000 },
            { title: 'ç¶²åŸŸçºŒè²» (10å¹´)', unit: 'å€‹', icon: 'fa-globe', color: 'slate', price: 5000 }
        ];

        let shuffledPool = [];
        let poolIndex = 0;
        let currentBatch = []; // Stores the currently displayed 7 items

        // Fisher-Yates Shuffle
        function shuffle(array) {
            let currentIndex = array.length, randomIndex;
            while (currentIndex != 0) {
                randomIndex = Math.floor(Math.random() * currentIndex);
                currentIndex--;
                [array[currentIndex], array[randomIndex]] = [array[randomIndex], array[currentIndex]];
            }
            return array;
        }

        function initPool() {
            // Create array of indices 0 to poolItems.length - 1
            let indices = Array.from({length: poolItems.length}, (_, i) => i);
            shuffledPool = shuffle(indices);
            poolIndex = 0;
            // Get initial batch
            getNextBatch();
        }

        function getNextBatch() {
            let batchIndices = [];
            for (let i = 0; i < 7; i++) {
                if (poolIndex >= shuffledPool.length) {
                    // Reshuffle if exhausted
                    shuffledPool = shuffle(shuffledPool);
                    poolIndex = 0;
                }
                batchIndices.push(shuffledPool[poolIndex]);
                poolIndex++;
            }
            currentBatch = batchIndices.map(idx => poolItems[idx]);
            return currentBatch;
        }

        // Called by Dice Button
        function refreshOpportunities() {
            // Animation effect on dice (optional visual feedback)
            const btn = document.querySelector('button[title="éš¨æ©Ÿæ›ç®—"] i');
            btn.classList.add('animate-spin');
            setTimeout(() => btn.classList.remove('animate-spin'), 500);

            getNextBatch(); // Updates currentBatch
            // Recalculate will re-render slider with new batch
            const totalImpact = parseFloat(document.getElementById('resultModal').getAttribute('data-total-impact')) || 0;
            const salary = parseFloat(document.getElementById('salary').value) || 0;
            const bonusType = document.querySelector('input[name="bonusType"]:checked').value;
            let annualPackage = 0;
            if (bonusType === '14') annualPackage = salary * 14;
            else if (bonusType === '12') annualPackage = salary * 12;
            else annualPackage = (salary * 12) + (parseFloat(document.getElementById('customBonus').value) || 0);
            
            const personAnnualCost = annualPackage * 1.5; // Multiplier

            renderOpportunitySlider(totalImpact, personAnnualCost);
        }

        // --- RENDER SLIDER (Updated to use currentBatch) ---
        function renderOpportunitySlider(totalImpact, personAnnualCost) {
            const container = document.getElementById('opportunitySlider');
            container.innerHTML = ''; 

            // Use currentBatch (or init if empty)
            if (currentBatch.length === 0) initPool();

            currentBatch.forEach(item => {
                let price = 0;
                if (typeof item.price === 'function') {
                    price = item.price(personAnnualCost);
                } else {
                    price = item.price;
                }

                let val = 0;
                if (price > 0) {
                    val = totalImpact / price;
                }

                // Formatting
                let displayVal = val < 10 ? val.toFixed(1) : Math.floor(val).toLocaleString();
                if (val < 0.1 && val > 0) displayVal = "<0.1";
                if (val === 0) displayVal = "0";

                const card = document.createElement('div');
                card.className = `flex-none min-w-[140px] bg-${item.color}-50 rounded-lg p-3 text-center border border-${item.color}-100 snap-center flex flex-col justify-center`;
                card.innerHTML = `
                    <i class="fas ${item.icon} text-${item.color}-500 text-lg mb-1"></i>
                    <div class="text-[10px] text-slate-500 font-medium mb-0.5 whitespace-normal leading-tight h-8 flex items-center justify-center">${item.title}</div>
                    <div class="text-sm font-bold text-${item.color}-700">
                        ${displayVal} <span class="text-xs font-normal">${item.unit}</span>
                    </div>
                `;
                container.appendChild(card);
            });

            // Always append Custom Card at the end
            const customCard = document.createElement('div');
            customCard.className = `flex-none min-w-[160px] bg-white rounded-lg p-2 text-center border-2 border-dashed border-slate-300 snap-center flex flex-col justify-center`;
            customCard.innerHTML = `
                <div class="text-[10px] text-slate-400 font-bold mb-2 uppercase">è‡ªè¨‚æ›ç®—</div>
                <div class="space-y-1 mb-2">
                    <input type="text" id="customName" placeholder="é …ç›® (ä¾‹: ä¼ºæœå™¨)" class="w-full text-[10px] border border-slate-200 rounded px-1 py-1 text-center bg-slate-50 focus:outline-none focus:border-blue-400">
                    <input type="number" id="customPrice" placeholder="å–®åƒ¹ (ä¾‹: 50000)" class="w-full text-[10px] border border-slate-200 rounded px-1 py-1 text-center bg-slate-50 focus:outline-none focus:border-blue-400" oninput="calcCustomCard()">
                </div>
                <div class="text-sm font-bold text-slate-700 bg-slate-100 rounded py-1">
                    <span id="customResult">-</span> <span id="customUnitDisplay" class="text-xs font-normal"></span>
                </div>
            `;
            container.appendChild(customCard);
            
            // Re-init scroll logic
            initSliderScroll();
        }

        // --- REST OF THE CODE (Markdown, Logic, Calculator, etc.) ---
        const defaultMarkdown = `
# è¨­è¨ˆå‚µå°å·¥ç¨‹é–‹ç™¼æ•ˆç‡ä¹‹å½±éŸ¿åˆ†æ

æ­¤è¡¨ç›¤é»äº†ç›®å‰çš„è¨­è¨ˆå‚µå¦‚ä½•å…·é«”è½‰åŒ–ç‚ºå·¥ç¨‹åœ˜éšŠçš„é–‹ç™¼æˆæœ¬èˆ‡æ•ˆç‡æè€—ã€‚

| å½±éŸ¿é¡åˆ¥ | é—œè¯è¨­è¨ˆå‚µ | å·¥ç¨‹å½±éŸ¿æ ¸å¿ƒ | å…·é«”å¾Œæœèˆ‡ç¾è±¡ | ğŸ’° æˆæœ¬æµªè²» |
| :--- | :--- | :--- | :--- | :--- |
| **1. é‡è¤‡é€ è¼ªå­**<br>*(Development Waste)* | â€¢ 1-1 ç„¡å…±ç”¨å…ƒä»¶<br>â€¢ 1-3 å¸¸ç”¨æ¨¡å¼æœªæ”¶éŒ„ | **å¾ã€Œçµ„è£ç©æœ¨ã€é€€åŒ–ç‚ºã€Œæ‰‹å·¥é›•åˆ»ã€**<br>é•å DRY (Don't Repeat Yourself) åŸå‰‡ã€‚ | â€¢ **æ•ˆç‡ä½è½**ï¼šç„¡æ³•ç›´æ¥ Importï¼Œé–‹ç™¼ç°¡å–®è¡¨å–®æ™‚é–“å¾ 30 åˆ†é˜æš´å¢è‡³ 3 å°æ™‚ã€‚<br>â€¢ **ä»£ç¢¼å†—é¤˜**ï¼šå°ˆæ¡ˆå……æ–¥å¹¾åå€‹ã€Œä¼¼æ˜¯è€Œéã€çš„é‡è¤‡çµ„ä»¶ã€‚<br>â€¢ **æ•ˆèƒ½éš±æ†‚**ï¼šç¼ºä¹å®˜æ–¹çµ„ä»¶å°è‡´å¼•å…¥å¤šé¤˜ç¬¬ä¸‰æ–¹å¥—ä»¶ï¼Œé€ æˆ Bundle size è†¨è„¹ã€‚ | **ç´”é–‹ç™¼å·¥æ™‚ (Man-hours)**<br>é«˜åƒ¹å€¼çš„æ ¸å¿ƒé‚è¼¯é–‹ç™¼æ™‚é–“ï¼Œè¢«æµªè²»åœ¨ä½åƒ¹å€¼çš„é‡è¤‡åˆ‡ç‰ˆä¸Šã€‚ |
| **2. ç„¡æ•ˆæºé€šèˆ‡ç¢ºèª**<br>*(Communication Overhead)* | â€¢ 2-1 Figma çµæ§‹æ··äº‚<br>â€¢ 2-2 ç„¡ Handoff Checklist | **ä¸­æ–·ã€Œå¿ƒæµ (Flow)ã€èˆ‡ä¸Šä¸‹æ–‡åˆ‡æ›**<br>å·¥ç¨‹å¸«æ·ªç‚ºã€Œæ‰¾æª”æ¡ˆã€èˆ‡ã€ŒçŒœè¬ã€çš„æ©Ÿå™¨ã€‚ | â€¢ **å°‹å¯¶éŠæˆ²**ï¼šåœ¨ v1/v2/Final ä¸­è¿·èˆªï¼Œæˆªåœ–å•ã€Œå“ªå€‹æ˜¯æº–çš„ï¼Ÿã€ã€‚<br>â€¢ **çŒœè¬éŠæˆ²**ï¼šç¼ºä¹ RWD/ç‹€æ…‹æ¨™è¨»ï¼Œå·¥ç¨‹å¸«é ç›´è¦ºçŒœæ¸¬å°è‡´ Bugã€‚<br>â€¢ **å°ˆæ³¨åŠ›æ­¸é›¶**ï¼šæ¯æ¬¡ç¢ºèªè¦æ ¼è¢«æ‰“æ–·ï¼Œéœ€ 23 åˆ†é˜æ‰èƒ½é‡å›ç·¨ç¢¼ç‹€æ…‹ã€‚ | **æºé€šæˆæœ¬ & èªçŸ¥è² è·**<br>å·¥ç¨‹å¸«æƒ…ç·’ç…©èºã€æ»¿æ„åº¦ä¸‹é™ï¼Œå°è‡´éš±æ€§æ€ å·¥ã€‚ |
| **3. é‡å·¥èˆ‡ä¿®è£œ**<br>*(Cost of Rework)* | â€¢ 1-2 è·¨å¹³å°ä¸ä¸€è‡´<br>â€¢ 3-1 A11y ç¼ºå¤± | **å°‡ã€Œé–‹ç™¼éšæ®µã€å•é¡Œå»¶å¾Œåˆ°ã€ŒQA/ç¶­é‹ã€çˆ†ç™¼**<br>è¶Šæ™šç™¼ç¾ Bugï¼Œä¿®å¾©æˆæœ¬è¶Šé«˜ã€‚ | â€¢ **é‚è¼¯åˆ†è£‚**ï¼šå› å¹³å°å·®ç•°å¯«å¤§é‡ \`if (isMobile)\`ï¼Œè£½é€  Bug æº«åºŠã€‚<br>â€¢ **å‚µå‹™åˆ©æ¯**ï¼šä¸Šç·šå¾Œè£œåš A11yï¼Œæˆæœ¬æ˜¯é–‹ç™¼æ™‚çš„ 10 å€ï¼ˆéœ€é‡æ§‹ DOMï¼‰ã€‚<br>â€¢ **ä¾†å›æ‹‰æ‰¯**ï¼šTicket åœ¨ QA/RD/Design ä¹‹é–“ç„¡é™ Ping-Pongï¼Œç„¡æ³•çµæ¡ˆã€‚ | **é‡æ§‹æˆæœ¬ & QA å¾ªç’°æˆæœ¬**<br>å¤§é‡è³‡æºæ¶ˆè€—åœ¨ä¿®å¾©æœ¬å¯é¿å…çš„éŒ¯èª¤ä¸Šã€‚ |
| **4. ç¶­è­·èˆ‡æ“´å……å›°é›£**<br>*(Scalability Issues)* | â€¢ 1-1 ç„¡ Token åŒ–<br>â€¢ 3-2 Wording ä¸çµ±ä¸€ | **ç³»çµ±è®Šå¾—ã€Œè„†å¼± (Fragile)ã€ä¸”é›£ä»¥ä¿®æ”¹**<br>ä»»ä½•å…¨åŸŸä¿®æ”¹éƒ½åƒåœ¨æ‹†å½ˆã€‚ | â€¢ **å…¨åŸŸä¿®æ”¹ææ‡¼**ï¼šæ”¹å“ç‰Œè‰²éœ€æ‰‹å‹•æ›¿æ›å¹¾åƒå€‹è‰²ç¢¼ï¼Œæ¥µæ˜“æ”¹éŒ¯é€ æˆäº‹æ•…ã€‚<br>â€¢ **ç¡¬ç·¨ç¢¼è©›å’’**ï¼šæ–‡æ¡ˆç„¡ Pattern å°è‡´ Hard-codeï¼Œä¿®æ”¹æ–‡æ¡ˆéœ€å‹• Code ä¸¦é‡æ–°éƒ¨ç½² (Deploy)ã€‚ | **ç¶­é‹æˆæœ¬ & æ©Ÿæœƒæˆæœ¬**<br>åœ˜éšŠè¢«èˆŠä»£ç¢¼ç¶æ¶ï¼Œç„¡æ³•å¿«é€ŸéŸ¿æ‡‰å¸‚å ´æ–°éœ€æ±‚ã€‚ |
`;

        async function loadMarkdown() {
            const container = document.querySelector('#efficiencyDetailsContent .table-container');
            try {
                const response = await fetch('efficiency_loss.md');
                if (response.ok) {
                    const text = await response.text();
                    container.innerHTML = marked.parse(text);
                } else {
                    container.innerHTML = marked.parse(defaultMarkdown);
                }
            } catch (e) {
                container.innerHTML = marked.parse(defaultMarkdown);
            }
        }

        function toggleEfficiencyDetails() {
            const content = document.getElementById('efficiencyDetailsContent');
            const icon = document.getElementById('effDetailsIcon');
            if (content.classList.contains('hidden')) {
                content.classList.remove('hidden');
                icon.classList.add('rotate-180');
                if(content.innerText.includes("è¼‰å…¥èªªæ˜ä¸­")) loadMarkdown();
            } else {
                content.classList.add('hidden');
                icon.classList.remove('rotate-180');
            }
        }

        function selectCustomRadio() {
            const radio = document.getElementById('bonusCustomRadio');
            if (!radio.checked) {
                radio.checked = true;
                toggleBonusInput();
            }
        }

        function toggleBonusInput() {
            const customRadio = document.getElementById('bonusCustomRadio');
            const customBonusWrapper = document.getElementById('customBonusWrapper');
            const fixedBtn = document.getElementById('fixedBonusBtn');
            const noneBtn = document.getElementById('noneBonusBtn');
            const hint = document.getElementById('bonusHint');
            
            if (customRadio.checked) {
                customBonusWrapper.classList.remove('bg-slate-50', 'border-slate-300');
                customBonusWrapper.classList.add('bg-white', 'border-blue-500', 'ring-1', 'ring-blue-500');
                fixedBtn.classList.add('bg-slate-50', 'text-slate-500', 'border-slate-300'); 
                fixedBtn.classList.remove('bg-white', 'text-slate-600', 'border-slate-300');
                noneBtn.classList.add('bg-slate-50', 'text-slate-500', 'border-slate-300');
                noneBtn.classList.remove('bg-white', 'text-slate-600', 'border-slate-300');
                hint.innerText = "å·²å•Ÿç”¨è‡ªè¨‚çé‡‘ï¼Œå°‡æ”¤æè‡³æ¯æœˆæˆæœ¬ã€‚";
            } else {
                customBonusWrapper.classList.add('bg-slate-50', 'border-slate-300');
                customBonusWrapper.classList.remove('bg-white', 'border-blue-500', 'ring-1', 'ring-blue-500');
                fixedBtn.classList.remove('bg-slate-50', 'text-slate-500', 'border-slate-200');
                fixedBtn.classList.add('bg-white', 'text-slate-600', 'border-slate-300');
                noneBtn.classList.remove('bg-slate-50', 'text-slate-500', 'border-slate-200');
                noneBtn.classList.add('bg-white', 'text-slate-600', 'border-slate-300');
                hint.innerText = "ç³»çµ±æœƒå°‡çé‡‘è‡ªå‹•æ”¤æè‡³æ¯æœˆæœˆè–ªæˆæœ¬ä¸­ã€‚";
            }
        }

        function toggleLogic() {
            const content = document.getElementById('logicContent');
            const icon = document.getElementById('logicIcon');
            if (content.classList.contains('hidden')) {
                content.classList.remove('hidden');
                setTimeout(() => icon.classList.add('rotate-180'), 10);
            } else {
                content.classList.add('hidden');
                icon.classList.remove('rotate-180');
            }
        }

        function toggleWcagOptions() {
            const toggle = document.getElementById('wcagToggle');
            const options = document.getElementById('wcagOptions');
            const placeholder = document.getElementById('wcagPlaceholder');
            if (toggle.checked) {
                options.classList.remove('hidden');
                placeholder.classList.add('hidden');
            } else {
                options.classList.add('hidden');
                placeholder.classList.remove('hidden');
                document.getElementById('riskRegion').value = "0"; 
            }
        }

        function runSlotMachineAnimation(container, finalValue) {
            const formattedString = "é ä¼°æå¤±  -" + new Intl.NumberFormat('zh-TW', { 
                style: 'currency', 
                currency: 'TWD', 
                maximumFractionDigits: 0 
            }).format(finalValue);

            container.innerHTML = '';
            container.classList.add('slot-machine-wrapper');

            const chars = formattedString.split('');
            chars.forEach((char, index) => {
                if (/\d/.test(char)) {
                    const windowDiv = document.createElement('div');
                    windowDiv.className = 'slot-digit-window';
                    const strip = document.createElement('div');
                    strip.className = 'slot-strip';
                    let numbersHTML = '';
                    for (let set = 3; set > 0; set--) { // Simplified loop
                       for (let i = 0; i <= 9; i++) {
                            numbersHTML += `<div class="slot-num">${i}</div>`;
                        }
                    }
                    // Duplicated loops to ensure scrolling works visually
                    for (let set = 0; set < 3; set++) {
                        for (let i = 0; i <= 9; i++) {
                            numbersHTML += `<div class="slot-num">${i}</div>`;
                        }
                    }
                    
                    // Reset to original loop for correctness
                    numbersHTML = '';
                    for (let set = 0; set < 3; set++) {
                        for (let i = 0; i <= 9; i++) {
                            numbersHTML += `<div class="slot-num">${i}</div>`;
                        }
                    }

                    strip.innerHTML = numbersHTML;
                    windowDiv.appendChild(strip);
                    container.appendChild(windowDiv);

                    const targetVal = parseInt(char);
                    const targetIndex = 20 + targetVal; 
                    const delay = index * 100; 
                    const duration = 1500;
                    
                    void strip.offsetWidth;

                    setTimeout(() => {
                        strip.style.transitionDuration = `${duration}ms`;
                        strip.style.transitionDelay = `${delay}ms`;
                        strip.style.transform = `translateY(-${targetIndex}em)`;
                    }, 50);
                } else {
                    const span = document.createElement('span');
                    span.textContent = char;
                    if (char === ' ') {
                        span.style.width = '0.25em'; 
                        span.style.display = 'inline-block';
                    }
                    container.appendChild(span);
                }
            });
        }

        function calcCustomCard() {
            const nameInput = document.getElementById('customName');
            const priceInput = document.getElementById('customPrice');
            const resultDisplay = document.getElementById('customResult');
            const resultUnit = document.getElementById('customUnitDisplay');
            
            const totalImpact = parseFloat(document.getElementById('resultModal').getAttribute('data-total-impact')) || 0;
            const price = parseFloat(priceInput.value);

            if (price > 0 && totalImpact > 0) {
                const count = Math.floor(totalImpact / price);
                resultDisplay.innerText = count.toLocaleString();
                resultUnit.innerText = "å€‹"; 
            } else {
                resultDisplay.innerText = "-";
            }
        }

        function initSliderScroll() {
            const slider = document.getElementById('opportunitySlider');
            const overlay = document.getElementById('sliderFadeOverlay');
            overlay.classList.remove('opacity-0');
            slider.onscroll = () => {
                const isEnd = slider.scrollLeft + slider.clientWidth >= slider.scrollWidth - 5;
                if (isEnd) overlay.classList.add('opacity-0');
                else overlay.classList.remove('opacity-0');
            };
        }

        function calculate() {
            const salary = parseFloat(document.getElementById('salary').value) || 0;
            const nDes = parseFloat(document.getElementById('nDes').value) || 0;
            const tDes = parseFloat(document.getElementById('tDes').value) || 0;
            const nDev = parseFloat(document.getElementById('nDev').value) || 0;
            const tDev = parseFloat(document.getElementById('tDev').value) || 0;
            const riskValue = parseFloat(document.getElementById('riskRegion').value) || 0;

            const bonusType = document.querySelector('input[name="bonusType"]:checked').value;
            let annualSalaryPackage = 0;

            if (bonusType === '14') annualSalaryPackage = salary * 14;
            else if (bonusType === '12') annualSalaryPackage = salary * 12;
            else annualSalaryPackage = (salary * 12) + (parseFloat(document.getElementById('customBonus').value) || 0);

            const multiplier = 1.5; 
            const workDays = 250;
            const hoursPerMonth = 160;

            const monthlyAvg = annualSalaryPackage / 12;
            const hourlyCost = (monthlyAvg * multiplier) / hoursPerMonth;
            const personAnnualCost = annualSalaryPackage * multiplier;

            const desAnnualHours = nDes * tDes * workDays;
            const devAnnualHours = nDev * tDev * workDays;
            const efficiencyLoss = (desAnnualHours + devAnnualHours) * hourlyCost;

            let finalRiskCost = riskValue;
            if (riskValue === 1) finalRiskCost = 0; 
            const totalImpact = efficiencyLoss + finalRiskCost;

            document.getElementById('resultModal').setAttribute('data-total-impact', totalImpact);

            const resultContainer = document.getElementById('finalResultContainer');
            runSlotMachineAnimation(resultContainer, totalImpact);

            document.getElementById('efficiencyResult').innerText = formatCurrency(efficiencyLoss);

            // Initial render with first batch
            renderOpportunitySlider(totalImpact, personAnnualCost);

            const riskEl = document.getElementById('riskBreakdown');
            const riskRes = document.getElementById('riskResult');
            
            if (document.getElementById('wcagToggle').checked && riskValue > 0) {
                riskEl.classList.remove('hidden');
                if (riskValue === 1) {
                    riskRes.innerText = "æ¨™æ¡ˆè³‡æ ¼å–ªå¤±";
                    riskRes.className = "font-bold text-red-600";
                } else {
                    riskRes.innerText = formatCurrency(riskValue);
                    riskRes.className = "font-bold text-red-600";
                }
            } else {
                riskEl.classList.add('hidden');
            }

            const modal = document.getElementById('resultModal');
            const modalContent = document.getElementById('modalContent');
            
            modal.classList.remove('hidden');
            void modal.offsetWidth;
            modal.classList.remove('opacity-0');
            modalContent.classList.remove('scale-95');
            modalContent.classList.add('scale-100');
            
            initSliderScroll();
        }

        function closeModal() {
            const modal = document.getElementById('resultModal');
            const modalContent = document.getElementById('modalContent');
            modal.classList.add('opacity-0');
            modalContent.classList.remove('scale-100');
            modalContent.classList.add('scale-95');
            setTimeout(() => {
                modal.classList.add('hidden');
            }, 300);
        }

        function formatCurrency(num) {
            return new Intl.NumberFormat('zh-TW', { 
                style: 'currency', 
                currency: 'TWD', 
                maximumFractionDigits: 0 
            }).format(num);
        }

        // Init Pool on load
        window.onload = initPool;
    </script>
</body>
</html>