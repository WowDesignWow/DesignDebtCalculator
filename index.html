<!DOCTYPE html>
<html lang="zh-TW" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¨­è¨ˆæ²»ç†èˆ‡åˆè¦é¢¨éšªè©¦ç®— V39 (Calculation Fix)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <!-- Google Fonts: Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;900&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'sans-serif'] },
                    colors: { 
                        slate: { 850: '#1e293b', 900: '#0f172a', 950: '#020617' },
                        sky: { 400: '#38bdf8', 500: '#0ea5e9', 600: '#0284c7' }
                    },
                    animation: { 
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'flip-up': 'flipUp 0.5s cubic-bezier(0.2, 0.8, 0.2, 1) forwards',
                    },
                    keyframes: {
                        flipUp: {
                            '0%': { opacity: '0', transform: 'rotateX(90deg) translateY(20px)' },
                            '100%': { opacity: '1', transform: 'rotateX(0deg) translateY(0)' },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        body { 
            background-color: #020617; 
            color: #e2e8f0;
            background-image: 
                radial-gradient(circle at 50% 0%, rgba(56, 189, 248, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 0% 50%, rgba(99, 102, 241, 0.05) 0%, transparent 50%);
            overflow-x: hidden;
        }
        
        /* Modern Scrollbar */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: #0f172a; border-radius: 4px; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #475569; }

        /* Slot Machine */
        .slot-machine-wrapper { display: inline-flex; align-items: baseline; font-weight: 900; line-height: 1; white-space: pre; }
        .slot-digit-window { display: inline-block; height: 1em; overflow: hidden; position: relative; vertical-align: bottom; }
        .slot-strip { display: flex; flex-direction: column; transition-timing-function: cubic-bezier(0.1, 0.75, 0.25, 1); transform: translateY(0); }
        .slot-num { height: 1em; display: flex; align-items: center; justify-content: center; }

        /* Utils */
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* Markdown Table */
        .prose { max-width: none; color: #94a3b8; }
        .prose table { width: 100%; border-collapse: collapse; margin-bottom: 1em; font-size: 12px; table-layout: fixed; }
        .prose th, .prose td { border: 1px solid #334155; padding: 12px; text-align: left; vertical-align: top; width: 20%; word-wrap: break-word; }
        .prose th { background-color: #1e293b; font-weight: 600; color: #f8fafc; position: sticky; top: 0; }
        .prose strong { color: #f1f5f9; font-weight: 600; }
        .prose code { background-color: #1e293b; padding: 2px 6px; border-radius: 4px; color: #38bdf8; font-size: 0.9em; border: 1px solid #334155; }
        
        /* Interactive Inputs */
        .input-standard { transition: all 0.2s ease; border-color: #334155; }
        .input-standard:hover { border-color: #38bdf8; }
        .input-standard:focus { border-color: #0ea5e9; box-shadow: 0 0 0 1px #0ea5e9; outline: none; }
        
        .input-wrapper-custom { transition: all 0.2s ease; }
        .input-wrapper-custom:hover { border-color: #38bdf8 !important; }

        .interactive-element { transition: all 0.2s ease; }
        .interactive-element:hover { border-color: #38bdf8; color: white; }
        
        input[type=number] { padding-right: 3rem; } 
        .cursor-grab { cursor: grab; }
        .cursor-grabbing { cursor: grabbing; }
        .card-flip { opacity: 0; transform-origin: top center; }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

    <!-- MAIN APP CONTAINER -->
    <div class="w-full max-w-lg rounded-3xl overflow-hidden flex flex-col h-[90vh] bg-slate-900/50 backdrop-blur-xl border border-slate-800 shadow-2xl relative z-10">
        
        <!-- App Header -->
        <div class="p-6 text-center flex-shrink-0 relative overflow-hidden border-b border-slate-800 bg-slate-900/80">
            <h1 class="text-2xl font-bold mb-1 tracking-tight text-white mt-2">è¨­è¨ˆæ²»ç†èˆ‡é¢¨éšªè©¦ç®—</h1>
            <p class="text-slate-400 text-xs uppercase tracking-widest font-semibold">Efficiency Loss + Compliance Risk</p>
        </div>

        <!-- Main Content -->
        <div class="p-6 space-y-6 overflow-y-auto flex-grow bg-slate-950/30" id="mainInputArea">
            
            <!-- Section 1: Basic Cost -->
            <div class="rounded-2xl border border-slate-800 bg-slate-900/50 p-5 shadow-sm hover:border-slate-700 transition-colors">
                <div class="flex items-center text-white font-bold border-b border-slate-800 pb-3 mb-4">
                    <div class="w-8 h-8 rounded-lg bg-sky-500/10 flex items-center justify-center mr-3"><i class="fas fa-coins text-sky-400"></i></div><span>åŸºç¤äººåŠ›æˆæœ¬</span>
                </div>
                <div class="space-y-4">
                    <div>
                        <label class="text-xs text-slate-400 font-bold uppercase block mb-1.5 ml-1">å¹³å‡æœˆè–ª (TWD)</label>
                        <div class="relative group"><input type="number" id="salary" value="70000" class="w-full bg-slate-950 border rounded-xl p-3 font-semibold text-white placeholder-slate-600 input-standard"></div>
                    </div>
                    <div>
                        <label class="text-xs text-slate-400 font-bold uppercase block mb-2 ml-1">å¹´çµ‚ï¼çé‡‘</label>
                        <div class="space-y-3">
                            <div class="flex space-x-3">
                                <label class="cursor-pointer block flex-1"><input type="radio" name="bonusType" value="14" id="bonusFixedRadio" class="peer sr-only" checked onchange="toggleBonusInput()"><div id="fixedBonusBtn" class="w-full text-center text-xs py-3 border border-slate-700 rounded-xl bg-slate-900 text-slate-300 font-medium interactive-element peer-checked:bg-sky-600 peer-checked:text-white peer-checked:border-sky-500">å›ºå®š 14 å€‹æœˆ</div></label>
                                <label class="cursor-pointer block flex-1"><input type="radio" name="bonusType" value="12" id="bonusNoneRadio" class="peer sr-only" onchange="toggleBonusInput()"><div id="noneBonusBtn" class="w-full text-center text-xs py-3 border border-slate-700 rounded-xl bg-slate-900 text-slate-300 font-medium interactive-element hover:border-sky-400 peer-checked:bg-sky-600 peer-checked:text-white peer-checked:border-sky-500">ç„¡</div></label>
                            </div>
                            <div class="relative w-full">
                                <input type="radio" name="bonusType" value="custom" id="bonusCustomRadio" class="peer sr-only" onchange="toggleBonusInput()">
                                <div id="customBonusWrapper" class="flex w-full rounded-xl border border-slate-700 bg-slate-950 overflow-hidden cursor-text group input-wrapper-custom" onclick="selectCustomRadio()">
                                    <input type="number" id="customBonus" placeholder="è¼¸å…¥è‡ªè¨‚çé‡‘ç¸½é¡" class="w-[80%] bg-transparent border-none p-3 pl-4 text-sm font-semibold text-white focus:outline-none placeholder-slate-600" onfocus="selectCustomRadio()">
                                    <div class="w-[20%] flex items-center justify-center border-l border-slate-700 bg-slate-900 text-xs text-slate-400 font-medium transition-colors">å…ƒ</div>
                                </div>
                            </div>
                        </div>
                        <p class="text-[10px] text-slate-500 mt-2 flex items-start ml-1"><i class="fas fa-info-circle mr-1.5 mt-0.5 text-sky-500"></i><span id="bonusHint">ç³»çµ±æœƒå°‡çé‡‘è‡ªå‹•æ”¤æè‡³æ¯æœˆæœˆè–ªæˆæœ¬ä¸­ã€‚</span></p>
                    </div>
                </div>
            </div>

            <!-- Section 2: Efficiency Loss -->
            <div class="rounded-2xl border border-slate-800 bg-slate-900/50 p-5 shadow-sm hover:border-slate-700 transition-colors relative overflow-hidden">
                <div class="absolute top-0 left-0 w-1 h-full bg-gradient-to-b from-orange-500 to-red-500"></div>
                <div class="flex items-center text-white font-bold border-b border-slate-800 pb-3 mb-4 pl-2">
                    <div class="w-8 h-8 rounded-lg bg-orange-500/10 flex items-center justify-center mr-3"><i class="fas fa-stopwatch text-orange-400"></i></div><span>æ²»ç†ç¼ºå¤±ï¼šæ•ˆç‡è€—æ</span>
                </div>
                <div class="mb-5 pb-5 border-b border-slate-800 last:border-0 last:pb-0 pl-2">
                    <div class="flex justify-between items-center mb-2"><label class="text-xs font-bold text-slate-300 flex items-center"><i class="fas fa-pen-nib text-slate-500 mr-2"></i>è¨­è¨ˆå¸«</label><span class="text-[10px] text-orange-300 bg-orange-500/10 px-2 py-1 rounded border border-orange-500/20">ç—›é»ï¼šç„¡ SSOT / ç‹€æ…‹æ··äº‚</span></div>
                    <div class="flex gap-3"><div class="flex-1"><label class="text-[10px] text-slate-500 block mb-1 uppercase font-bold">åœ˜éšŠäººæ•¸</label><div class="flex w-full rounded-xl border border-slate-700 bg-slate-950 overflow-hidden input-wrapper-custom"><input type="number" id="nDes" value="5" class="w-[70%] bg-transparent border-none p-2.5 pl-3 text-sm font-bold text-white focus:outline-none"><div class="w-[30%] flex items-center justify-center border-l border-slate-700 bg-slate-900 text-xs text-slate-400">äºº</div></div></div><div class="flex-1"><label class="text-[10px] text-slate-500 block mb-1 uppercase font-bold">æ¯æ—¥æµªè²»</label><div class="flex w-full rounded-xl border border-slate-700 bg-slate-950 overflow-hidden input-wrapper-custom"><input type="number" id="tDes" value="0.75" step="0.25" class="w-[70%] bg-transparent border-none p-2.5 pl-3 text-sm font-bold text-white focus:outline-none bg-orange-500/5"><div class="w-[30%] flex items-center justify-center border-l border-slate-700 bg-slate-900 text-xs text-slate-400">å°æ™‚</div></div></div></div>
                </div>
                <div class="pl-2">
                    <div class="flex justify-between items-center mb-2"><label class="text-xs font-bold text-slate-300 flex items-center"><i class="fas fa-code text-slate-500 mr-2"></i>å·¥ç¨‹å¸«</label><span class="text-[10px] text-orange-300 bg-orange-500/10 px-2 py-1 rounded border border-orange-500/20">ç—›é»ï¼šé‡è¤‡ Override / çŒœæ¸¬</span></div>
                    <div class="flex gap-3"><div class="flex-1"><label class="text-[10px] text-slate-500 block mb-1 uppercase font-bold">åœ˜éšŠäººæ•¸</label><div class="flex w-full rounded-xl border border-slate-700 bg-slate-950 overflow-hidden input-wrapper-custom"><input type="number" id="nDev" value="3" class="w-[70%] bg-transparent border-none p-2.5 pl-3 text-sm font-bold text-white focus:outline-none"><div class="w-[30%] flex items-center justify-center border-l border-slate-700 bg-slate-900 text-xs text-slate-400">äºº</div></div></div><div class="flex-1"><label class="text-[10px] text-slate-500 block mb-1 uppercase font-bold">æ¯æ—¥æµªè²»</label><div class="flex w-full rounded-xl border border-slate-700 bg-slate-950 overflow-hidden input-wrapper-custom"><input type="number" id="tDev" value="0.5" step="0.25" class="w-[70%] bg-transparent border-none p-2.5 pl-3 text-sm font-bold text-white focus:outline-none bg-orange-500/5"><div class="w-[30%] flex items-center justify-center border-l border-slate-700 bg-slate-900 text-xs text-slate-400">å°æ™‚</div></div></div></div>
                </div>
            </div>

            <!-- Section 3: WCAG Risk -->
            <div class="rounded-2xl border border-red-900/30 bg-slate-900/50 p-5 shadow-sm hover:border-red-900/50 transition-colors relative overflow-hidden">
                <div class="absolute top-0 left-0 w-1 h-full bg-red-600"></div>
                <div class="flex items-center justify-between border-b border-red-900/30 pb-3 mb-4 pl-2">
                    <div class="font-bold text-white flex items-center"><div class="w-8 h-8 rounded-lg bg-red-500/10 flex items-center justify-center mr-3"><i class="fas fa-gavel text-red-500"></i></div><span>æ³•å¾‹èˆ‡åˆè¦é¢¨éšª</span></div>
                    <label class="relative inline-flex items-center cursor-pointer"><input type="checkbox" id="wcagToggle" class="sr-only peer" onchange="toggleWcagOptions()"><div class="w-11 h-6 bg-slate-800 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-slate-400 after:border-slate-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-red-600 peer-checked:after:bg-white peer-checked:after:border-white"></div></label>
                </div>
                <div id="wcagOptions" class="hidden space-y-3 transition-all pl-2">
                    <p class="text-[10px] text-red-400 mb-2"><i class="fas fa-exclamation-triangle mr-1"></i>2025/2026 EAA èˆ‡ ADA å¼·åˆ¶åŸ·è¡Œï¼Œé•è¦å°‡é¢è‡¨é«˜é¡ç½°æ¬¾ã€‚</p>
                    <div class="relative group"><select id="riskRegion" class="w-full text-sm bg-slate-950 border border-red-900/50 rounded-xl p-3 text-slate-200 focus:border-red-500 focus:ring-1 focus:ring-red-500 outline-none hover:border-red-700 transition-colors appearance-none cursor-pointer input-standard"><option value="0" class="bg-slate-900">è«‹é¸æ“‡ç›®æ¨™å¸‚å ´é¢¨éšª...</option><option value="600000" class="bg-slate-900">ğŸ‡ºğŸ‡¸ ç¾åœ‹ (ADA è¨´è¨Ÿé¢¨éšª ~2è¬ç¾é‡‘)</option><option value="3300000" class="bg-slate-900">ğŸ‡ªğŸ‡º æ­ç›Ÿ (EAA ç½°é°ä¸Šé™é¢¨éšª ~10è¬æ­å…ƒ)</option><option value="1" class="bg-slate-900">ğŸ‡¹ğŸ‡¼ å°ç£ (å…¬éƒ¨é–€æ¨™æ¡ˆè³‡æ ¼å–ªå¤±)</option></select><div class="absolute right-4 top-3.5 pointer-events-none text-red-500"><i class="fas fa-chevron-down text-xs"></i></div></div>
                </div>
                <div id="wcagPlaceholder" class="text-xs text-slate-500 italic pl-2">é–‹å•Ÿæ­¤é¸é …ä»¥è©•ä¼°æ½›åœ¨æ³•å¾‹ç½°æ¬¾èˆ‡å¸‚å ´æå¤±ã€‚</div>
            </div>

            <!-- Logic Explanation -->
            <div class="rounded-2xl border border-slate-800 bg-slate-900/50 p-5 shadow-sm hover:border-slate-700 transition-colors">
                <div class="flex justify-between items-center cursor-pointer group" onclick="toggleLogic()">
                    <h3 class="text-sm font-bold text-slate-300 flex items-center group-hover:text-white transition-colors">
                        <i class="fas fa-book-open mr-2 text-slate-500 group-hover:text-sky-400"></i> è¨ˆç®—é‚è¼¯è©³è§£
                    </h3>
                    <div class="w-6 h-6 rounded-full border border-slate-700 flex items-center justify-center group-hover:border-sky-500 group-hover:bg-sky-500/10 transition-colors">
                        <i class="fas fa-chevron-down text-slate-500 text-[10px] transform transition-transform duration-300 group-hover:text-sky-400" id="logicIcon"></i>
                    </div>
                </div>
                <div id="logicContent" class="hidden mt-5 space-y-4 text-xs text-slate-400 leading-relaxed border-t border-slate-800 pt-4">
                    <div>
                        <h4 class="font-bold text-slate-200 mb-1 flex items-center"><span class="w-4 h-4 bg-sky-600 text-white rounded-full flex items-center justify-center text-[10px] mr-2">1</span>çœŸå¯¦äººåŠ›æˆæœ¬ (Fully Loaded Cost)</h4>
                        <p class="pl-6 mb-2">å…¬å¼ï¼š<code class="text-sky-300 bg-slate-950 px-1 border border-slate-800 rounded">((æœˆè–ª Ã— 12 + å¹´çµ‚çé‡‘) Ã· 12) Ã— 1.5 Ã· 160å°æ™‚</code></p>
                        <ul class="pl-6 list-disc list-outside space-y-1 text-slate-400">
                            <li><strong class="text-slate-300">å¹´çµ‚æ”¤æï¼š</strong> å°‡å¹´è–ªèˆ‡é¡å¤–çé‡‘ç¸½é¡æ”¤æè‡³æ¯æœˆï¼Œåæ˜ å…¬å¸å¯¦éš›æ”¯ä»˜çš„æœˆå¹³å‡ç¾é‡‘æµã€‚</li>
                            <li><strong class="text-slate-300">1.5å€ç‡Ÿé‹ä¿‚æ•¸ï¼š</strong> æ­¤ç‚ºè²¡å‹™æœƒè¨ˆä¿å®ˆä¼°è¨ˆå€¼ï¼Œæ¶µè“‹ï¼š
                                <ul class="list-none pl-0 mt-1 space-y-1 text-slate-500">
                                    <li>â€¢ æ³•å®šæˆæœ¬ï¼šå‹å¥ä¿(ç´„20%)ã€é€€ä¼‘é‡‘(6%)ã€‚</li>
                                    <li>â€¢ ç‡Ÿé‹æˆæœ¬ï¼šè¾¦å…¬å®¤ç§Ÿé‡‘ã€æ°´é›»ã€ç¶²è·¯ã€è¡Œæ”¿ç®¡ç†è²»ã€‚</li>
                                    <li>â€¢ è»Ÿç¡¬é«”æˆæœ¬ï¼šFigma/Adobe æˆæ¬Šã€é›»è…¦è¨­å‚™æŠ˜èˆŠã€‚</li>
                                </ul>
                            </li>
                        </ul>
                    </div>
                    <div>
                        <h4 class="font-bold text-slate-200 mb-1 flex items-center"><span class="w-4 h-4 bg-orange-500 text-white rounded-full flex items-center justify-center text-[10px] mr-2">2</span>è²»ç±³æ¨å®šï¼šæ•ˆç‡æµªè²» (Efficiency Waste)</h4>
                        <p class="pl-6 mb-2">ä¾æ“šè¨­è¨ˆå‚µç¾æ³æ¨ç®—çš„æ¯æ—¥ç„¡æ•ˆå·¥æ™‚ï¼š</p>
                        <ul class="pl-6 list-disc list-outside space-y-1 text-slate-400">
                            <li><strong class="text-slate-300">è¨­è¨ˆç«¯ï¼š</strong> åœ¨æ··äº‚çš„æª”æ¡ˆä¸­å°‹æ‰¾èˆŠç¨¿ã€å› ç„¡å…±ç”¨å…ƒä»¶è€Œé‡è¤‡ç¹ªè£½ã€æ‰‹å‹•åŒæ­¥å¤šå€‹ç‹€æ…‹çš„ä¿®æ”¹ã€‚</li>
                            <li><strong class="text-slate-300">é–‹ç™¼ç«¯ï¼š</strong> æ¸¬é‡è¨­è¨ˆç¨¿åƒç´ (Pixel-peeping)ã€çŒœæ¸¬è¨­è¨ˆæ„åœ–ã€æ’°å¯«é‡è¤‡çš„ CSS Override ä¾†è¦†è“‹æ¨£å¼ã€‚</li>
                        </ul>
                    </div>
                    <div>
                        <h4 class="font-bold text-slate-200 mb-1 flex items-center"><span class="w-4 h-4 bg-red-600 text-white rounded-full flex items-center justify-center text-[10px] mr-2">3</span>é¢¨éšªä¼°å€¼ (Risk Assessment)</h4>
                        <p class="pl-6 text-slate-400"><strong class="text-slate-300">åˆè¦é¢¨éšªï¼š</strong> ä¾æ“šåœ‹éš›è¨´è¨Ÿæ¡ˆä¾‹ï¼ˆADA å¹³å‡å’Œè§£é‡‘ï¼‰èˆ‡æ­ç›Ÿæ³•è¦ï¼ˆEAA ç½°é°ä¸Šé™ï¼‰è¨­å®šçš„æ½›åœ¨é¢¨éšªæ•å£ã€‚é€™ä¸¦éå›ºå®šæˆæœ¬ï¼Œè€Œæ˜¯ã€Œä¸è™•ç†å°±æœƒé¢è‡¨ã€çš„é æœŸæå¤±ã€‚</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="p-5 border-t border-slate-800 bg-slate-900/90 backdrop-blur z-10 flex-shrink-0">
            <!-- Updated Button Gradient -->
            <button onclick="calculate()" class="group w-full bg-gradient-to-r from-sky-600 to-indigo-600 hover:from-sky-500 hover:to-indigo-500 text-white font-bold py-4 px-4 rounded-xl shadow-lg shadow-sky-900/30 transition-all flex items-center justify-center border border-white/10 active:scale-95"><span class="text-lg tracking-wide">è¨ˆç®—ç¸½é«”ç‡Ÿé‹è¡æ“Š</span><div class="ml-3 w-6 h-6 rounded-full bg-white/20 flex items-center justify-center group-hover:bg-white/30 transition-colors"><i class="fas fa-arrow-right text-sm group-hover:translate-x-0.5 transition-transform"></i></div></button>
        </div>
    </div>

    <!-- RESULT MODAL -->
    <div id="resultModal" class="fixed inset-0 z-50 hidden" aria-labelledby="modal-title" role="dialog" aria-modal="true">
        <div class="fixed inset-0 bg-black/80 backdrop-blur-sm transition-opacity opacity-0" id="modalOverlay"></div>
        <div class="fixed inset-0 z-10 w-screen overflow-y-auto">
            <div class="flex min-h-full items-center justify-center p-4 text-center sm:p-0">
                <div class="relative transform overflow-hidden rounded-3xl bg-slate-900 border border-slate-700 text-left shadow-2xl transition-all sm:my-8 sm:w-full sm:max-w-2xl opacity-0 scale-95" id="modalPanel">
                    
                    <div class="bg-slate-900 px-6 py-6 sm:p-8">
                        <div class="flex justify-between items-start mb-6 border-b border-slate-800 pb-4">
                            <div><h2 class="text-slate-200 text-sm font-bold uppercase tracking-widest flex items-center"><i class="fas fa-chart-pie mr-2 text-sky-500"></i>å¹´åº¦é ä¼°ç¸½è¡æ“Š</h2><p class="text-[10px] text-slate-500 mt-1">æ•ˆç‡è€—æ (OpEx) + æ½›åœ¨åˆè¦é¢¨éšª (Risk)</p></div>
                            <button onclick="closeModal()" class="text-slate-500 hover:text-white transition-colors w-8 h-8 flex items-center justify-center rounded-full hover:bg-slate-800 cursor-pointer"><i class="fas fa-times text-xl"></i></button>
                        </div>

                        <!-- 1. BIG RESULT -->
                        <div class="mb-8 text-center" id="finalResultContainer"></div>

                        <!-- 2. Opportunity Slider (Reordered) -->
                        <div class="mb-6 relative rounded-2xl border border-sky-900/30 bg-slate-950/30 p-5 overflow-hidden">
                            <div class="flex justify-between items-center mb-4">
                                <h3 class="text-xs font-bold text-sky-400 uppercase tracking-wide flex items-center"><i class="fas fa-search-dollar mr-2"></i> é€™ç­†éŒ¢åŸæœ¬å¯ä»¥æ‹¿ä¾†...</h3>
                                <div class="flex items-center">
                                    <button onclick="refreshOpportunities()" class="p-2 rounded-lg bg-slate-800 hover:bg-sky-600 text-sky-400 hover:text-white transition-all mr-3 cursor-pointer border border-slate-700" title="éš¨æ©Ÿæ›ç®—"><i class="fas fa-dice text-lg transition-transform duration-500"></i></button>
                                </div>
                            </div>
                            <div class="relative"><div class="flex overflow-x-auto hide-scrollbar gap-3 pb-2 snap-x snap-mandatory items-stretch py-4 cursor-grab select-none active:cursor-grabbing" id="opportunitySlider"></div><div id="sliderFadeOverlay" class="absolute right-0 top-0 bottom-0 w-20 bg-gradient-to-l from-slate-900 via-slate-900/80 to-transparent pointer-events-none transition-opacity duration-300"></div></div>
                        </div>

                        <!-- 3. Health & Delay (Reordered) -->
                        <div class="grid grid-cols-2 gap-4 mb-6">
                            <div class="bg-slate-950/50 rounded-xl border border-slate-800 p-4 relative overflow-hidden">
                                <div class="text-[10px] text-slate-500 font-bold uppercase tracking-widest mb-1">åœ˜éšŠå¥åº·åº¦è©•ç´š</div>
                                <div class="flex items-end"><div class="text-4xl font-black text-transparent bg-clip-text bg-gradient-to-br from-red-500 to-orange-600" id="healthGrade">F</div><div class="text-xs text-slate-400 mb-1 ml-2 font-medium">/ æ¥µåº¦å±éšª</div></div>
                            </div>
                            <div class="bg-slate-950/50 rounded-xl border border-slate-800 p-4 relative overflow-hidden">
                                <div class="text-[10px] text-slate-500 font-bold uppercase tracking-widest mb-1">å°ˆæ¡ˆå»¶é²æ¨¡æ“¬</div>
                                <div class="flex items-end"><div class="text-xl font-bold text-white">æ¯å­£è½å¾Œ <span class="text-orange-400 text-2xl" id="delayDays">0</span> å¤©</div></div>
                                <div class="w-full bg-slate-800 h-1.5 rounded-full mt-3 overflow-hidden"><div class="bg-orange-500 h-full w-[80%] animate-pulse-slow"></div></div>
                            </div>
                        </div>

                        <!-- 4. Modal Logic Explanation -->
                        <div class="mb-6 rounded-2xl border border-slate-800 bg-slate-900/50 p-5 shadow-sm hover:border-slate-700 transition-colors">
                            <div class="flex justify-between items-center cursor-pointer group" onclick="toggleModalLogic()">
                                <h3 class="text-sm font-bold text-slate-300 flex items-center group-hover:text-white transition-colors">
                                    <i class="fas fa-calculator mr-2 text-slate-500 group-hover:text-sky-400"></i> è©•ç´šèˆ‡å»¶é²è¨ˆç®—é‚è¼¯
                                </h3>
                                <div class="w-6 h-6 rounded-full border border-slate-700 flex items-center justify-center group-hover:border-sky-500 group-hover:bg-sky-500/10 transition-colors">
                                    <i class="fas fa-chevron-down text-slate-500 text-[10px] transform transition-transform duration-300 group-hover:text-sky-400" id="modalLogicIcon"></i>
                                </div>
                            </div>
                            <div id="modalLogicContent" class="hidden mt-5 space-y-4 text-xs text-slate-400 leading-relaxed border-t border-slate-800 pt-4">
                                <div>
                                    <strong class="text-slate-200">1. åœ˜éšŠå¥åº·åº¦ (Health Grade)</strong>
                                    <p class="mt-1">åŸºæ–¼ã€Œç„¡æ•ˆå·¥æ™‚ä½”æ¯”ã€é€²è¡Œè©•ç´šï¼š<code>(ç¸½æµªè²»å·¥æ™‚ / åœ˜éšŠç¸½ç”¢èƒ½)</code></p>
                                    <div class="grid grid-cols-5 gap-1 mt-2 text-[10px] text-center font-bold">
                                        <div class="bg-green-900/30 text-green-400 rounded py-1 border border-green-900/50">&lt;5%<br>A</div>
                                        <div class="bg-lime-900/30 text-lime-400 rounded py-1 border border-lime-900/50">5-10%<br>B</div>
                                        <div class="bg-yellow-900/30 text-yellow-400 rounded py-1 border border-yellow-900/50">10-15%<br>C</div>
                                        <div class="bg-orange-900/30 text-orange-400 rounded py-1 border border-orange-900/50">15-20%<br>D</div>
                                        <div class="bg-red-900/30 text-red-400 rounded py-1 border border-red-900/50">&gt;20%<br>F</div>
                                    </div>
                                </div>
                                <div><strong class="text-slate-200">2. å°ˆæ¡ˆå»¶é²æ¨¡æ“¬ (Project Delay)</strong><p class="mt-1">å‡è¨­ä¸€å€‹æ¨™æº–å­£åº¦ç‚º 60 å€‹å·¥ä½œå¤© (3å€‹æœˆ)ã€‚</p><p>å…¬å¼ï¼š<code>60å¤© Ã— (ç¸½æµªè²»å·¥æ™‚ Ã· ç¸½ç”¢èƒ½å·¥æ™‚)</code></p><p class="mt-1 text-slate-500">ä»£è¡¨æ¯éä¸€å­£ï¼Œå› ç‚ºé‡è¤‡ä½œæ¥­èˆ‡æºé€šå…§è€—ï¼Œå°ˆæ¡ˆé€²åº¦å°±æœƒæ†‘ç©ºè’¸ç™¼çš„å·¥ä½œå¤©æ•¸ã€‚</p></div>
                            </div>
                        </div>

                        <!-- 5. Breakdown -->
                        <div class="space-y-4 border-t border-slate-800 pt-6">
                            <h4 class="text-[10px] font-bold text-slate-500 uppercase tracking-wider">æå¤±ç´°é … breakdown</h4>
                            <div class="bg-slate-800/50 rounded-xl p-4 border border-slate-800 hover:border-slate-700 transition-colors">
                                <div class="flex justify-between items-center text-xs cursor-pointer" onclick="toggleEfficiencyDetails()">
                                    <div class="flex items-center text-slate-300 font-bold"><i class="fas fa-hourglass-half text-orange-400 w-5 text-center mr-3"></i>æ•ˆç‡æµªè²»</div>
                                    <div class="flex items-center"><span class="font-bold text-slate-200 mr-3" id="efficiencyResult">$0</span><i class="fas fa-chevron-down text-slate-500 transition-transform" id="effDetailsIcon"></i></div>
                                </div>
                                <div id="efficiencyDetailsContent" class="hidden mt-4 pt-2"><div class="max-h-[300px] overflow-y-auto pr-2 text-xs text-slate-400"><div class="table-container prose prose-invert prose-sm max-w-none">è¼‰å…¥èªªæ˜ä¸­...</div></div></div>
                            </div>
                            <div id="riskBreakdown" class="hidden bg-red-900/10 rounded-xl p-4 border border-red-900/30">
                                <div class="flex justify-between items-center text-xs"><div class="flex items-center text-red-200 font-bold"><i class="fas fa-gavel text-red-500 w-5 text-center mr-3"></i>åˆè¦é¢¨éšª</div><div class="font-bold text-red-400" id="riskResult">$0</div></div>
                            </div>
                        </div>

                        <div class="mt-8">
                            <button onclick="closeModal()" class="w-full bg-slate-800 hover:bg-slate-700 text-white font-bold py-4 rounded-xl transition-all border border-slate-700 hover:border-slate-600 shadow-lg">é—œé–‰ä¸¦èª¿æ•´ç­–ç•¥</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let isFirstSlide = true; 

        // UPDATED POOL ITEMS (blue -> sky where appropriate)
        const poolItems = [
            { title: 'å¢è˜è³‡æ·±å·¥ç¨‹å¸«', unit: 'äºº', icon: 'fa-user-plus', color: 'blue', price: (b) => b * 1.1 },
            { title: 'å¢è˜è³‡æ·±è¨­è¨ˆå¸«', unit: 'äºº', icon: 'fa-pen-nib', color: 'violet', price: (b) => b * 0.9 },
            { title: 'é ‚è¦ MacBook Pro', unit: 'å°', icon: 'fa-laptop', color: 'slate', price: 80000 },
            { title: 'Herman Miller æ¤…', unit: 'å¼µ', icon: 'fa-chair', color: 'teal', price: 45000 },
            { title: 'Figma ä¼æ¥­å¹´è²»', unit: 'å¹´', icon: 'fa-file-invoice-dollar', color: 'pink', price: 150000 },
            { title: 'Tesla Model 3', unit: 'è¼›', icon: 'fa-car', color: 'rose', price: 1750000 },
            { title: 'AWS é›²ç«¯å¸³å–®', unit: 'æœˆ', icon: 'fa-cloud', color: 'orange', price: 30000 },
            { title: 'Copilot åœ˜éšŠ', unit: 'å¹´', icon: 'fa-robot', color: 'emerald', price: 60000 },
            { title: 'Google Workspace', unit: 'å¹´', icon: 'fa-envelope', color: 'red', price: 80000 },
            { title: 'ç±³å…¶æ—éƒ¨é–€èšé¤', unit: 'å ´', icon: 'fa-utensils', color: 'red', price: 60000 },
            { title: 'å¥ˆè‰¯ç¾æ™ºç‰ˆç•«', unit: 'å¹…', icon: 'fa-palette', color: 'yellow', price: 200000 },
            { title: 'å•†å‹™è‰™ (ç¾è¥¿)', unit: 'å¼µ', icon: 'fa-plane', color: 'sky', price: 120000 },
            { title: 'å“¡å·¥æ—…éŠ (æ²–ç¹©)', unit: 'äºº', icon: 'fa-umbrella-beach', color: 'cyan', price: 30000 },
            { title: 'App Store å»£å‘Š', unit: 'å¤©', icon: 'fa-ad', color: 'rose', price: 5000 },
            { title: 'Nespresso è† å›Š', unit: 'å¹´', icon: 'fa-coffee', color: 'amber', price: 20000 },
            { title: 'æ³•å¾‹é¡§å•è«®è©¢', unit: 'æ™‚', icon: 'fa-balance-scale', color: 'emerald', price: 6000 },
            { title: 'æŠ€è¡“å¹´æœƒé–€ç¥¨', unit: 'å¼µ', icon: 'fa-ticket-alt', color: 'lime', price: 8000 },
            { title: 'æ©Ÿæ¢°éµç›¤ (å…¨å“¡)', unit: 'çµ„', icon: 'fa-keyboard', color: 'fuchsia', price: 40000 },
            { title: '4K å°ˆæ¥­è¢å¹•', unit: 'å°', icon: 'fa-desktop', color: 'zinc', price: 18000 },
            { title: 'å¢è˜å°ˆæ¡ˆç¶“ç†', unit: 'äºº', icon: 'fa-tasks', color: 'indigo', price: (b) => b * 1.0 },
            { title: 'å¢è˜ QA å·¥ç¨‹å¸«', unit: 'äºº', icon: 'fa-bug', color: 'sky', price: (b) => b * 0.8 },
        ];

        let shuffledPool = [], poolIndex = 0, currentBatch = [];

        function shuffle(array) {
            let currentIndex = array.length, randomIndex;
            while (currentIndex != 0) {
                randomIndex = Math.floor(Math.random() * currentIndex);
                currentIndex--;
                [array[currentIndex], array[randomIndex]] = [array[randomIndex], array[currentIndex]];
            }
            return array;
        }

        function initPool() {
            let indices = Array.from({length: poolItems.length}, (_, i) => i);
            shuffledPool = shuffle(indices);
            poolIndex = 0;
            getNextBatch();
        }

        function getNextBatch() {
            let batchIndices = [];
            for (let i = 0; i < 7; i++) {
                if (poolIndex >= shuffledPool.length) { shuffledPool = shuffle(shuffledPool); poolIndex = 0; }
                batchIndices.push(shuffledPool[poolIndex]);
                poolIndex++;
            }
            currentBatch = batchIndices.map(idx => poolItems[idx]);
            return currentBatch;
        }

        function refreshOpportunities() {
            const btn = document.querySelector('button[title="éš¨æ©Ÿæ›ç®—"] i');
            btn.classList.add('animate-spin');
            setTimeout(() => btn.classList.remove('animate-spin'), 500);
            isFirstSlide = false; 
            getNextBatch();
            
            const totalImpactAttr = document.getElementById('resultModal').getAttribute('data-total-impact');
            const totalImpact = totalImpactAttr ? parseFloat(totalImpactAttr) : 0;
            const salary = parseFloat(document.getElementById('salary').value) || 0;
            const bonusType = document.querySelector('input[name="bonusType"]:checked').value;
            let annualSalaryPackage = 0; // FIXED Variable
            const fixedRadio = document.getElementById('bonusFixedRadio');
            const noneRadio = document.getElementById('bonusNoneRadio');
            const customRadio = document.getElementById('bonusCustomRadio');
            
            if (fixedRadio.checked) annualSalaryPackage = salary * 14;
            else if (noneRadio.checked) annualSalaryPackage = salary * 12;
            else if (customRadio.checked) annualSalaryPackage = (salary * 12) + (parseFloat(document.getElementById('customBonus').value) || 0);
            
            const personAnnualCost = annualSalaryPackage * 1.5; 
            
            renderOpportunitySlider(totalImpact, personAnnualCost);
        }

        function renderOpportunitySlider(totalImpact, personAnnualCost) {
            const container = document.getElementById('opportunitySlider');
            container.innerHTML = ''; 
            if (currentBatch.length === 0) initPool();

            currentBatch.forEach((item, index) => {
                let price = typeof item.price === 'function' ? item.price(personAnnualCost) : item.price;
                let val = price > 0 ? totalImpact / price : 0;
                let displayVal = val < 10 ? val.toFixed(1) : Math.floor(val).toLocaleString();
                if (val < 0.1 && val > 0) displayVal = "<0.1"; if (val === 0) displayVal = "0";

                const colorMap = {
                    blue: 'bg-sky-500/10 text-sky-400 border-sky-500/20', purple: 'bg-purple-500/10 text-purple-400 border-purple-500/20', indigo: 'bg-indigo-500/10 text-indigo-400 border-indigo-500/20', sky: 'bg-sky-500/10 text-sky-400 border-sky-500/20', teal: 'bg-teal-500/10 text-teal-400 border-teal-500/20', emerald: 'bg-emerald-500/10 text-emerald-400 border-emerald-500/20', green: 'bg-green-500/10 text-green-400 border-green-500/20', lime: 'bg-lime-500/10 text-lime-400 border-lime-500/20', yellow: 'bg-yellow-500/10 text-yellow-400 border-yellow-500/20', amber: 'bg-amber-500/10 text-amber-400 border-amber-500/20', orange: 'bg-orange-500/10 text-orange-400 border-orange-500/20', red: 'bg-red-500/10 text-red-400 border-red-500/20', rose: 'bg-rose-500/10 text-rose-400 border-rose-500/20', pink: 'bg-pink-500/10 text-pink-400 border-pink-500/20', fuchsia: 'bg-fuchsia-500/10 text-fuchsia-400 border-fuchsia-500/20', violet: 'bg-violet-500/10 text-violet-400 border-violet-500/20', slate: 'bg-slate-700/30 text-slate-300 border-slate-600/30', gray: 'bg-gray-700/30 text-gray-300 border-gray-600/30', zinc: 'bg-zinc-700/30 text-zinc-300 border-zinc-600/30', neutral: 'bg-neutral-700/30 text-neutral-300 border-neutral-600/30', stone: 'bg-stone-700/30 text-stone-300 border-stone-600/30'
                };
                const styleClass = colorMap[item.color] || colorMap['slate'];

                const card = document.createElement('div');
                let animClasses = "";
                if (isFirstSlide) {
                    animClasses = "card-flip animate-flip-up";
                    card.style.animationDelay = `${index * 0.1}s`;
                }
                // FIXED: Explicit w-[140px] and h-[140px]
                card.className = `flex-none w-[140px] h-[140px] rounded-xl p-2 text-center border snap-center flex flex-col justify-center ${styleClass} ${animClasses}`;

                card.innerHTML = `<i class="fas ${item.icon} text-2xl mb-2 opacity-80"></i><div class="text-[10px] font-medium mb-1 truncate opacity-70">${item.title}</div><div class="text-lg font-bold">${displayVal} <span class="text-xs font-normal opacity-60">${item.unit}</span></div>`;
                container.appendChild(card);
            });

            const customCard = document.createElement('div');
            let customAnimClasses = "";
            if (isFirstSlide) {
                customAnimClasses = "card-flip animate-flip-up";
                customCard.style.animationDelay = `${currentBatch.length * 0.1}s`;
            }
            // FIXED: Explicit w-[140px] and h-[140px]
            customCard.className = `flex-none w-[140px] h-[140px] bg-slate-900/50 rounded-xl p-2 text-center border border-dashed border-slate-600 snap-center flex flex-col justify-center hover:border-sky-500/50 transition-colors ${customAnimClasses}`;
            
            customCard.innerHTML = `
                <div class="text-[10px] text-slate-400 font-bold mb-1 uppercase">è‡ªè¨‚æ›ç®—</div>
                <div class="space-y-1 mb-1">
                    <input type="text" id="customName" placeholder="é …ç›®" class="w-full text-[10px] border border-slate-700 rounded-lg px-1 py-1 text-center bg-slate-950 text-white focus:outline-none focus:border-sky-500 placeholder-slate-600">
                    <input type="number" id="customPrice" placeholder="å–®åƒ¹" class="w-full text-[10px] border border-slate-700 rounded-lg px-1 py-1 text-center bg-slate-950 text-white focus:outline-none focus:border-sky-500 placeholder-slate-600" oninput="calcCustomCard()">
                </div>
                <div class="text-sm font-bold text-white bg-slate-800 rounded-lg py-1 border border-slate-700">
                    <span id="customResult">-</span> <span id="customUnitDisplay" class="text-[10px] font-normal text-slate-400"></span>
                </div>
            `;
            container.appendChild(customCard);
            initSliderScroll();
        }

        // --- Core Logic ---
        function selectCustomRadio() {
            const radio = document.getElementById('bonusCustomRadio');
            if (!radio.checked) { radio.checked = true; toggleBonusInput(); }
        }

        function toggleBonusInput() {
            const customRadio = document.getElementById('bonusCustomRadio');
            const customBonusWrapper = document.getElementById('customBonusWrapper');
            const fixedBtn = document.getElementById('fixedBonusBtn');
            const noneBtn = document.getElementById('noneBonusBtn');
            const hint = document.getElementById('bonusHint');
            
            if (customRadio.checked) {
                // Active Custom (Dark Mode)
                customBonusWrapper.classList.remove('border-slate-700', 'bg-slate-950');
                customBonusWrapper.classList.add('border-sky-500', 'bg-slate-900', 'ring-1', 'ring-sky-500');
                
                // Disable Buttons (Visual) - Dim them out
                fixedBtn.classList.remove('text-slate-300', 'hover:border-sky-400', 'hover:text-white', 'peer-checked:bg-sky-600', 'peer-checked:border-sky-500');
                fixedBtn.classList.add('text-slate-600', 'border-slate-800', 'bg-slate-950');
                
                noneBtn.classList.remove('text-slate-300', 'hover:border-sky-400', 'hover:text-white', 'peer-checked:bg-sky-600', 'peer-checked:border-sky-500');
                noneBtn.classList.add('text-slate-600', 'border-slate-800', 'bg-slate-950');

                hint.innerText = "å·²å•Ÿç”¨è‡ªè¨‚çé‡‘ï¼Œå°‡æ”¤æè‡³æ¯æœˆæˆæœ¬ã€‚";
            } else {
                // Inactive Custom
                customBonusWrapper.classList.add('border-slate-700', 'bg-slate-950');
                customBonusWrapper.classList.remove('border-sky-500', 'bg-slate-900', 'ring-1', 'ring-sky-500');
                
                // Enable Buttons
                fixedBtn.classList.add('text-slate-300', 'hover:border-sky-400', 'hover:text-white', 'peer-checked:bg-sky-600', 'peer-checked:border-sky-500');
                fixedBtn.classList.remove('text-slate-600', 'border-slate-800', 'bg-slate-950'); 
                
                noneBtn.classList.add('text-slate-300', 'hover:border-sky-400', 'hover:text-white', 'peer-checked:bg-sky-600', 'peer-checked:border-sky-500');
                noneBtn.classList.remove('text-slate-600', 'border-slate-800', 'bg-slate-950');
                
                hint.innerText = "ç³»çµ±æœƒå°‡çé‡‘è‡ªå‹•æ”¤æè‡³æ¯æœˆæœˆè–ªæˆæœ¬ä¸­ã€‚";
            }
        }

        const defaultMarkdown = `
# è¨­è¨ˆå‚µå°å·¥ç¨‹é–‹ç™¼æ•ˆç‡ä¹‹å½±éŸ¿åˆ†æ

æ­¤è¡¨ç›¤é»äº†ç›®å‰çš„è¨­è¨ˆå‚µå¦‚ä½•å…·é«”è½‰åŒ–ç‚ºå·¥ç¨‹åœ˜éšŠçš„é–‹ç™¼æˆæœ¬èˆ‡æ•ˆç‡æè€—ã€‚

| å½±éŸ¿é¡åˆ¥ | é—œè¯è¨­è¨ˆå‚µ | å·¥ç¨‹å½±éŸ¿æ ¸å¿ƒ | å…·é«”å¾Œæœèˆ‡ç¾è±¡ | ğŸ’° æˆæœ¬æµªè²» |
| :--- | :--- | :--- | :--- | :--- |
| **1. é‡è¤‡é€ è¼ªå­**<br>*(Development Waste)* | â€¢ 1-1 ç„¡å…±ç”¨å…ƒä»¶<br>â€¢ 1-3 å¸¸ç”¨æ¨¡å¼æœªæ”¶éŒ„ | **å¾ã€Œçµ„è£ç©æœ¨ã€é€€åŒ–ç‚ºã€Œæ‰‹å·¥é›•åˆ»ã€**<br>é•å DRY åŸå‰‡ã€‚ | â€¢ **æ•ˆç‡ä½è½**ï¼šé–‹ç™¼ç°¡å–®è¡¨å–®æ™‚é–“å¾ 30 åˆ†æš´å¢è‡³ 3 å°æ™‚ã€‚<br>â€¢ **ä»£ç¢¼å†—é¤˜**ï¼šå°ˆæ¡ˆå……æ–¥é‡è¤‡çµ„ä»¶ã€‚<br>â€¢ **æ•ˆèƒ½éš±æ†‚**ï¼šBundle size è†¨è„¹ã€‚ | **ç´”é–‹ç™¼å·¥æ™‚**<br>æ ¸å¿ƒé–‹ç™¼æ™‚é–“è¢«æµªè²»åœ¨åˆ‡ç‰ˆä¸Šã€‚ |
| **2. ç„¡æ•ˆæºé€šèˆ‡ç¢ºèª**<br>*(Communication Overhead)* | â€¢ 2-1 Figma çµæ§‹æ··äº‚<br>â€¢ 2-2 ç„¡ Handoff Checklist | **ä¸­æ–·ã€Œå¿ƒæµã€èˆ‡ä¸Šä¸‹æ–‡åˆ‡æ›**<br>å·¥ç¨‹å¸«æ·ªç‚ºã€Œæ‰¾æª”æ¡ˆã€æ©Ÿå™¨ã€‚ | â€¢ **å°‹å¯¶éŠæˆ²**ï¼šåœ¨ v1/v2/Final ä¸­è¿·èˆªã€‚<br>â€¢ **çŒœè¬éŠæˆ²**ï¼šç¼ºä¹æ¨™è¨»é ç›´è¦ºçŒœæ¸¬ã€‚<br>â€¢ **å°ˆæ³¨åŠ›æ­¸é›¶**ï¼šæ‰“æ–·å¾Œéœ€ 23 åˆ†é˜é‡å›ç‹€æ…‹ã€‚ | **æºé€šæˆæœ¬**<br>å·¥ç¨‹å¸«æ»¿æ„åº¦ä¸‹é™ã€‚ |
| **3. é‡å·¥èˆ‡ä¿®è£œ**<br>*(Cost of Rework)* | â€¢ 1-2 è·¨å¹³å°ä¸ä¸€è‡´<br>â€¢ 3-1 A11y ç¼ºå¤± | **å°‡å•é¡Œå»¶å¾Œåˆ°ã€ŒQA/ç¶­é‹ã€çˆ†ç™¼**<br>è¶Šæ™šç™¼ç¾ Bugï¼Œä¿®å¾©æˆæœ¬è¶Šé«˜ã€‚ | â€¢ **é‚è¼¯åˆ†è£‚**ï¼šå› å¹³å°å·®ç•°å¯«å¤§é‡ if-elseã€‚<br>â€¢ **å‚µå‹™åˆ©æ¯**ï¼šäº‹å¾Œè£œåš A11y æˆæœ¬æ˜¯ 10 å€ã€‚<br>â€¢ **ä¾†å›æ‹‰æ‰¯**ï¼šTicket ç„¡é™ Ping-Pongã€‚ | **é‡æ§‹æˆæœ¬**<br>è³‡æºæ¶ˆè€—åœ¨ä¿®å¾©éŒ¯èª¤ä¸Šã€‚ |
| **4. ç¶­è­·èˆ‡æ“´å……å›°é›£**<br>*(Scalability Issues)* | â€¢ 1-1 ç„¡ Token åŒ–<br>â€¢ 3-2 Wording ä¸çµ±ä¸€ | **ç³»çµ±è®Šå¾—ã€Œè„†å¼±ã€ä¸”é›£ä»¥ä¿®æ”¹**<br>ä»»ä½•å…¨åŸŸä¿®æ”¹éƒ½åƒåœ¨æ‹†å½ˆã€‚ | â€¢ **å…¨åŸŸä¿®æ”¹ææ‡¼**ï¼šæ”¹è‰²ç¢¼æ¥µæ˜“æ”¹éŒ¯ã€‚<br>â€¢ **ç¡¬ç·¨ç¢¼è©›å’’**ï¼šæ–‡æ¡ˆ Hard-code éœ€é‡éƒ¨ç½²ã€‚ | **ç¶­é‹æˆæœ¬**<br>è¢«èˆŠä»£ç¢¼ç¶æ¶ã€‚ |
`;

        async function loadMarkdown() {
            const container = document.querySelector('#efficiencyDetailsContent .table-container');
            try {
                const response = await fetch('efficiency_loss.md');
                if (response.ok) {
                    const text = await response.text();
                    container.innerHTML = marked.parse(text);
                } else {
                    container.innerHTML = marked.parse(defaultMarkdown);
                }
            } catch (e) {
                container.innerHTML = marked.parse(defaultMarkdown);
            }
        }

        function toggleEfficiencyDetails() {
            const content = document.getElementById('efficiencyDetailsContent');
            const icon = document.getElementById('effDetailsIcon');
            if (content.classList.contains('hidden')) {
                content.classList.remove('hidden');
                icon.classList.add('rotate-180');
                if(content.innerText.includes("è¼‰å…¥èªªæ˜ä¸­")) loadMarkdown();
            } else {
                content.classList.add('hidden');
                icon.classList.remove('rotate-180');
            }
        }

        function toggleModalLogic() {
            const content = document.getElementById('modalLogicContent');
            const icon = document.getElementById('modalLogicIcon');
            if (content.classList.contains('hidden')) {
                content.classList.remove('hidden');
                icon.classList.add('rotate-180');
            } else {
                content.classList.add('hidden');
                icon.classList.remove('rotate-180');
            }
        }

        function toggleLogic() {
            const content = document.getElementById('logicContent');
            const icon = document.getElementById('logicIcon');
            if (content.classList.contains('hidden')) {
                content.classList.remove('hidden');
                setTimeout(() => icon.classList.add('rotate-180'), 10);
            } else {
                content.classList.add('hidden');
                icon.classList.remove('rotate-180');
            }
        }

        function toggleWcagOptions() {
            const toggle = document.getElementById('wcagToggle');
            const options = document.getElementById('wcagOptions');
            const placeholder = document.getElementById('wcagPlaceholder');
            if (toggle.checked) {
                options.classList.remove('hidden');
                placeholder.classList.add('hidden');
            } else {
                options.classList.add('hidden');
                placeholder.classList.remove('hidden');
                document.getElementById('riskRegion').value = "0"; 
            }
        }

        function runSlotMachineAnimation(container, finalValue) {
            const formattedString = "-" + new Intl.NumberFormat('zh-TW', { 
                style: 'currency', 
                currency: 'TWD', 
                maximumFractionDigits: 0 
            }).format(finalValue);

            container.innerHTML = '';
            // New Layout: Label on top left of number
            const wrapper = document.createElement('div');
            wrapper.className = 'flex flex-col items-start'; // Align label to left

            const label = document.createElement('div');
            label.textContent = 'é ä¼°æå¤±';
            label.className = 'text-sm text-red-400 font-bold mb-1 opacity-80'; // Updated style
            wrapper.appendChild(label);

            const numberRow = document.createElement('div');
            numberRow.className = 'slot-machine-wrapper text-5xl font-black text-red-500 tracking-tight'; // Big Number

            const chars = formattedString.split('');
            chars.forEach((char, index) => {
                if (/\d/.test(char)) {
                    const windowDiv = document.createElement('div');
                    windowDiv.className = 'slot-digit-window';
                    const strip = document.createElement('div');
                    strip.className = 'slot-strip';
                    let numbersHTML = '';
                    for (let set = 0; set < 3; set++) { for (let i = 0; i <= 9; i++) { numbersHTML += `<div class="slot-num">${i}</div>`; } }
                    strip.innerHTML = numbersHTML;
                    windowDiv.appendChild(strip);
                    numberRow.appendChild(windowDiv);
                    const targetVal = parseInt(char);
                    const targetIndex = 20 + targetVal; 
                    const delay = index * 80; 
                    const duration = 1500;
                    void strip.offsetWidth;
                    setTimeout(() => {
                        strip.style.transitionDuration = `${duration}ms`;
                        strip.style.transitionDelay = `${delay}ms`;
                        strip.style.transform = `translateY(-${targetIndex}em)`;
                    }, 50);
                } else {
                    const span = document.createElement('span');
                    span.textContent = char;
                    if (char === ' ') { span.style.width = '0.5em'; span.style.display = 'inline-block'; }
                    numberRow.appendChild(span);
                }
            });

            wrapper.appendChild(numberRow);
            container.appendChild(wrapper);
        }

        function calcCustomCard() {
            const priceInput = document.getElementById('customPrice');
            const resultDisplay = document.getElementById('customResult');
            const resultUnit = document.getElementById('customUnitDisplay');
            const totalImpact = parseFloat(document.getElementById('resultModal').getAttribute('data-total-impact')) || 0;
            const price = parseFloat(priceInput.value);
            if (price > 0 && totalImpact > 0) {
                const count = Math.floor(totalImpact / price);
                resultDisplay.innerText = count.toLocaleString();
                resultUnit.innerText = "å€‹"; 
            } else {
                resultDisplay.innerText = "-";
            }
        }

        function initSliderScroll() {
            const slider = document.getElementById('opportunitySlider');
            const overlay = document.getElementById('sliderFadeOverlay');
            overlay.classList.remove('opacity-0');
            // Drag Logic
            let isDown = false, startX, scrollLeft;
            slider.addEventListener('mousedown', (e) => { isDown = true; slider.classList.add('active'); slider.classList.remove('snap-x', 'snap-mandatory'); startX = e.pageX - slider.offsetLeft; scrollLeft = slider.scrollLeft; });
            slider.addEventListener('mouseleave', () => { isDown = false; slider.classList.remove('active'); slider.classList.add('snap-x', 'snap-mandatory'); });
            slider.addEventListener('mouseup', () => { isDown = false; slider.classList.remove('active'); slider.classList.add('snap-x', 'snap-mandatory'); });
            slider.addEventListener('mousemove', (e) => { if (!isDown) return; e.preventDefault(); const x = e.pageX - slider.offsetLeft; const walk = (x - startX) * 2; slider.scrollLeft = scrollLeft - walk; });
            slider.onscroll = () => { const isEnd = slider.scrollLeft + slider.clientWidth >= slider.scrollWidth - 5; if (isEnd) overlay.classList.add('opacity-0'); else overlay.classList.remove('opacity-0'); };
        }

        function calculate() {
            const salary = parseFloat(document.getElementById('salary').value) || 0;
            const nDes = parseFloat(document.getElementById('nDes').value) || 0;
            const tDes = parseFloat(document.getElementById('tDes').value) || 0;
            const nDev = parseFloat(document.getElementById('nDev').value) || 0;
            const tDev = parseFloat(document.getElementById('tDev').value) || 0;
            const riskValue = parseFloat(document.getElementById('riskRegion').value) || 0;

            const fixedRadio = document.getElementById('bonusFixedRadio');
            const noneRadio = document.getElementById('bonusNoneRadio');
            const customRadio = document.getElementById('bonusCustomRadio');
            
            let annualSalaryPackage = 0; // FIXED Variable
            if (fixedRadio.checked) {
                annualSalaryPackage = salary * 14;
            } else if (noneRadio.checked) {
                annualSalaryPackage = salary * 12;
            } else if (customRadio.checked) {
                annualSalaryPackage = (salary * 12) + (parseFloat(document.getElementById('customBonus').value) || 0);
            }

            const multiplier = 1.5; const workDays = 250; const hoursPerMonth = 160;
            const monthlyAvg = annualSalaryPackage / 12;
            const hourlyCost = (monthlyAvg * multiplier) / hoursPerMonth;
            const personAnnualCost = annualSalaryPackage * multiplier;

            const desAnnualHours = nDes * tDes * workDays;
            const devAnnualHours = nDev * tDev * workDays;
            const efficiencyLoss = (desAnnualHours + devAnnualHours) * hourlyCost;

            let finalRiskCost = riskValue;
            if (riskValue === 1) finalRiskCost = 0; 
            const totalImpact = efficiencyLoss + finalRiskCost;

            document.getElementById('resultModal').setAttribute('data-total-impact', totalImpact);
            const resultContainer = document.getElementById('finalResultContainer');
            
            // Set flag for first run
            isFirstSlide = true;
            
            runSlotMachineAnimation(resultContainer, totalImpact);
            document.getElementById('efficiencyResult').innerText = formatCurrency(efficiencyLoss);
            
            // DELAY RENDER
            const container = document.getElementById('opportunitySlider');
            container.innerHTML = ''; 
            setTimeout(() => { renderOpportunitySlider(totalImpact, personAnnualCost); }, 1500);

            // Calculate Delay & Health
            const teamSize = nDes + nDev;
            const totalWastedHours = desAnnualHours + devAnnualHours;
            // Updated Formula: 60days * (Total Wasted Hours / Total Capacity Hours)
            const totalCapacityHours = teamSize * 8 * 250; 
            const wastedRatio = totalWastedHours / totalCapacityHours;
            const daysWastedPerQuarter = Math.round(60 * wastedRatio * 10) / 10;
            document.getElementById('delayDays').innerText = daysWastedPerQuarter;

            // Health Grade
            let grade = 'A', gradeColor = 'from-green-400 to-emerald-600', gradeText = 'å¥åº·';
            if (wastedRatio > 0.05) { grade = 'B'; gradeColor = 'from-lime-400 to-green-600'; gradeText = 'å°šå¯'; }
            if (wastedRatio > 0.10) { grade = 'C'; gradeColor = 'from-yellow-400 to-orange-500'; gradeText = 'äºå¥åº·'; }
            if (wastedRatio > 0.15) { grade = 'D'; gradeColor = 'from-orange-500 to-red-500'; gradeText = 'å±éšª'; }
            if (wastedRatio > 0.20) { grade = 'F'; gradeColor = 'from-red-600 to-rose-900'; gradeText = 'æ¥µåº¦å±éšª'; }
            
            const gradeEl = document.getElementById('healthGrade');
            gradeEl.innerText = grade;
            gradeEl.className = `text-4xl font-black text-transparent bg-clip-text bg-gradient-to-br ${gradeColor}`;
            gradeEl.nextElementSibling.innerText = `/ ${gradeText}`;

            const riskEl = document.getElementById('riskBreakdown');
            const riskRes = document.getElementById('riskResult');
            if (document.getElementById('wcagToggle').checked && riskValue > 0) {
                riskEl.classList.remove('hidden');
                if (riskValue === 1) {
                    riskRes.innerText = "æ¨™æ¡ˆè³‡æ ¼å–ªå¤±";
                    riskRes.className = "font-bold text-red-600";
                } else {
                    riskRes.innerText = formatCurrency(riskValue);
                    riskRes.className = "font-bold text-red-600";
                }
            } else {
                riskEl.classList.add('hidden');
            }

            const modal = document.getElementById('resultModal');
            modal.classList.remove('hidden');
            void modal.offsetWidth;
            modal.querySelector('#modalOverlay').classList.remove('opacity-0');
            modal.querySelector('#modalPanel').classList.remove('opacity-0', 'scale-95');
            modal.querySelector('#modalPanel').classList.add('opacity-100', 'scale-100');
            
            initSliderScroll();
        }

        function closeModal() {
            const modal = document.getElementById('resultModal');
            const overlay = document.getElementById('modalOverlay');
            const panel = document.getElementById('modalPanel');
            
            overlay.classList.add('opacity-0');
            panel.classList.remove('opacity-100', 'scale-100');
            panel.classList.add('opacity-0', 'scale-95');
            
            setTimeout(() => {
                modal.classList.add('hidden');
            }, 300);
        }

        function formatCurrency(num) {
            return new Intl.NumberFormat('zh-TW', { 
                style: 'currency', 
                currency: 'TWD', 
                maximumFractionDigits: 0 
            }).format(num);
        }

        window.onload = () => {
            initPool();
            setupSliderDrag(); // Fix 3: Bind events once
        };

        // NEW: Separate setup function
        function setupSliderDrag() {
            const slider = document.getElementById('opportunitySlider');
            const overlay = document.getElementById('sliderFadeOverlay');
            if (!slider || !overlay) return;

            let isDown = false, startX, scrollLeft;
            slider.addEventListener('mousedown', (e) => { isDown = true; slider.classList.add('active'); slider.classList.remove('snap-x', 'snap-mandatory'); startX = e.pageX - slider.offsetLeft; scrollLeft = slider.scrollLeft; });
            slider.addEventListener('mouseleave', () => { isDown = false; slider.classList.remove('active'); slider.classList.add('snap-x', 'snap-mandatory'); });
            slider.addEventListener('mouseup', () => { isDown = false; slider.classList.remove('active'); slider.classList.add('snap-x', 'snap-mandatory'); });
            slider.addEventListener('mousemove', (e) => { if (!isDown) return; e.preventDefault(); const x = e.pageX - slider.offsetLeft; const walk = (x - startX) * 2; slider.scrollLeft = scrollLeft - walk; });
            slider.onscroll = () => { const isEnd = slider.scrollLeft + slider.clientWidth >= slider.scrollWidth - 5; if (isEnd) overlay.classList.add('opacity-0'); else overlay.classList.remove('opacity-0'); };
        }
    </script>
</body>
</html>