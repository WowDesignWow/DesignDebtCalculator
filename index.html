<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¨­è¨ˆæ²»ç†èˆ‡åˆè¦é¢¨éšªè©¦ç®—</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- FontAwesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <!-- Marked.js for Markdown parsing -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background-color: #f0f2f5; }
        .card-shadow { box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04); }
        .gradient-bg { background: linear-gradient(135deg, #0f172a 0%, #334155 100%); }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }

        /* --- Slot Machine Styles --- */
        .slot-machine-wrapper {
            display: inline-flex;
            align-items: baseline;
            overflow: hidden;
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            font-weight: 900;
            line-height: 1;
        }
        .slot-digit-window {
            display: inline-block;
            height: 1em;
            overflow: hidden;
            position: relative;
            vertical-align: bottom;
        }
        .slot-strip {
            display: flex;
            flex-direction: column;
            transition-timing-function: cubic-bezier(0.1, 0.75, 0.25, 1);
            transform: translateY(0); 
        }
        .slot-num {
            height: 1em;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* --- Slider Styles --- */
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* Table Styles for Markdown Content */
        .prose { max-width: none; }
        .prose table { width: 100%; border-collapse: collapse; margin-bottom: 1em; font-size: 11px; }
        .prose th, .prose td { border: 1px solid #e2e8f0; padding: 8px; text-align: left; vertical-align: top; }
        .prose th { background-color: #f8fafc; font-weight: 700; color: #475569; }
        /* Ensure table is scrollable */
        .table-container { overflow-x: auto; -webkit-overflow-scrolling: touch; }
        .prose ul { list-style-type: disc; padding-left: 1.2em; margin-top: 0.2em; }
        .prose li { margin-bottom: 0.2em; }
        .prose strong { color: #334155; }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

    <div class="bg-white w-full max-w-lg rounded-3xl card-shadow overflow-hidden flex flex-col h-[90vh]">
        
        <!-- App Header -->
        <div class="gradient-bg p-6 text-white text-center flex-shrink-0 relative overflow-hidden">
            <div class="absolute top-0 right-0 p-4 opacity-10"><i class="fas fa-balance-scale text-6xl"></i></div>
            <h1 class="text-2xl font-bold mb-1 tracking-wide">è¨­è¨ˆæ²»ç†èˆ‡é¢¨éšªè©¦ç®—</h1>
            <p class="text-slate-300 text-xs uppercase tracking-wider font-semibold">Efficiency Loss + Compliance Risk</p>
        </div>

        <!-- Main Content (Inputs) -->
        <div class="p-6 space-y-5 overflow-y-auto flex-grow bg-slate-50">
            
            <!-- Section 1: Basic Cost -->
            <div class="bg-white rounded-xl border border-slate-200 p-4 shadow-sm">
                <div class="flex items-center text-slate-800 font-bold border-b border-slate-100 pb-2 mb-3">
                    <i class="fas fa-coins text-blue-600 mr-2"></i>
                    <span>åŸºç¤äººåŠ›æˆæœ¬</span>
                </div>
                <div class="space-y-3">
                    <div>
                        <label class="text-xs text-slate-500 font-bold uppercase block mb-1">å¹³å‡æœˆè–ª (TWD)</label>
                        <input type="number" id="salary" value="70000" class="w-full bg-slate-50 border border-slate-300 rounded-lg p-2 font-semibold text-slate-700 focus:ring-2 focus:ring-blue-500 outline-none">
                    </div>
                    <div>
                        <label class="text-xs text-slate-500 font-bold uppercase block mb-1">å¹´è–ªæœˆæ•¸ (å«å¹´çµ‚)</label>
                        <div class="flex space-x-2">
                            <label class="flex-1 cursor-pointer"><input type="radio" name="months" value="13" class="peer sr-only"><div class="text-center text-xs py-2 border rounded-md peer-checked:bg-blue-600 peer-checked:text-white transition">13å€‹æœˆ</div></label>
                            <label class="flex-1 cursor-pointer"><input type="radio" name="months" value="14" class="peer sr-only" checked><div class="text-center text-xs py-2 border rounded-md peer-checked:bg-blue-600 peer-checked:text-white transition">14å€‹æœˆ</div></label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Section 2: Efficiency Loss -->
            <div class="bg-white rounded-xl border border-slate-200 p-4 shadow-sm relative group">
                <div class="absolute -left-1 top-4 w-1 h-12 bg-orange-400 rounded-r"></div>
                <div class="flex items-center text-slate-800 font-bold border-b border-slate-100 pb-2 mb-3">
                    <i class="fas fa-stopwatch text-orange-500 mr-2"></i>
                    <span>æ²»ç†ç¼ºå¤±ï¼šæ•ˆç‡è€—æ</span>
                </div>
                
                <!-- Designer -->
                <div class="mb-4 pb-4 border-b border-slate-50 last:border-0 last:pb-0">
                    <div class="flex justify-between items-center mb-2">
                        <label class="text-xs font-bold text-slate-700 flex items-center">
                            <i class="fas fa-pen-nib text-slate-400 mr-1.5 text-[10px]"></i>è¨­è¨ˆå¸«
                        </label>
                        <span class="text-[10px] text-orange-600 bg-orange-50 px-2 py-0.5 rounded-full border border-orange-100">ç—›é»ï¼šç„¡ SSOT / ç‹€æ…‹æ··äº‚</span>
                    </div>
                    <div class="flex gap-3">
                        <div class="flex-1">
                            <label class="text-[10px] text-slate-400 block mb-1 uppercase tracking-wide font-semibold">åœ˜éšŠäººæ•¸</label>
                            <div class="relative">
                                <input type="number" id="nDes" value="5" class="w-full border border-slate-300 rounded-lg p-2 text-sm font-bold text-slate-700 focus:ring-2 focus:ring-blue-500 outline-none">
                                <span class="absolute right-3 top-2 text-xs text-slate-400 pointer-events-none">äºº</span>
                            </div>
                        </div>
                        <div class="flex-1">
                            <label class="text-[10px] text-slate-400 block mb-1 uppercase tracking-wide font-semibold">æ¯æ—¥æµªè²»å·¥æ™‚</label>
                            <div class="relative">
                                <input type="number" id="tDes" value="0.75" step="0.25" class="w-full border border-slate-300 rounded-lg p-2 text-sm font-bold text-slate-700 focus:ring-2 focus:ring-blue-500 outline-none bg-orange-50/30">
                                <span class="absolute right-3 top-2 text-xs text-slate-400 pointer-events-none">å°æ™‚</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Developer -->
                <div>
                    <div class="flex justify-between items-center mb-2">
                        <label class="text-xs font-bold text-slate-700 flex items-center">
                            <i class="fas fa-code text-slate-400 mr-1.5 text-[10px]"></i>å·¥ç¨‹å¸«
                        </label>
                        <span class="text-[10px] text-orange-600 bg-orange-50 px-2 py-0.5 rounded-full border border-orange-100">ç—›é»ï¼šé‡è¤‡ Override / çŒœæ¸¬æ¨£å¼</span>
                    </div>
                    <div class="flex gap-3">
                        <div class="flex-1">
                            <label class="text-[10px] text-slate-400 block mb-1 uppercase tracking-wide font-semibold">åœ˜éšŠäººæ•¸</label>
                            <div class="relative">
                                <input type="number" id="nDev" value="3" class="w-full border border-slate-300 rounded-lg p-2 text-sm font-bold text-slate-700 focus:ring-2 focus:ring-blue-500 outline-none">
                                <span class="absolute right-3 top-2 text-xs text-slate-400 pointer-events-none">äºº</span>
                            </div>
                        </div>
                        <div class="flex-1">
                            <label class="text-[10px] text-slate-400 block mb-1 uppercase tracking-wide font-semibold">æ¯æ—¥æµªè²»å·¥æ™‚</label>
                            <div class="relative">
                                <input type="number" id="tDev" value="0.5" step="0.25" class="w-full border border-slate-300 rounded-lg p-2 text-sm font-bold text-slate-700 focus:ring-2 focus:ring-blue-500 outline-none bg-orange-50/30">
                                <span class="absolute right-3 top-2 text-xs text-slate-400 pointer-events-none">å°æ™‚</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Section 3: WCAG Risk -->
            <div class="bg-white rounded-xl border border-red-200 p-4 shadow-sm relative overflow-hidden">
                <div class="absolute -left-1 top-4 w-1 h-12 bg-red-500 rounded-r"></div>
                <div class="flex items-center justify-between border-b border-red-100 pb-2 mb-3">
                    <div class="font-bold text-slate-800 flex items-center">
                        <i class="fas fa-gavel text-red-500 mr-2"></i>
                        <span>æ³•å¾‹èˆ‡åˆè¦é¢¨éšª (WCAG)</span>
                    </div>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" id="wcagToggle" class="sr-only peer" onchange="toggleWcagOptions()">
                        <div class="w-9 h-5 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-red-600"></div>
                    </label>
                </div>
                
                <div id="wcagOptions" class="hidden space-y-3 transition-all">
                    <p class="text-[10px] text-red-500 mb-2">
                        <i class="fas fa-exclamation-triangle"></i> 
                        2025/2026 EAA èˆ‡ ADA å¼·åˆ¶åŸ·è¡Œï¼Œé•è¦å°‡é¢è‡¨é«˜é¡ç½°æ¬¾ã€‚
                    </p>
                    <select id="riskRegion" class="w-full text-sm border-red-200 border rounded-lg p-2.5 bg-red-50 text-slate-700 focus:ring-red-500">
                        <option value="0">è«‹é¸æ“‡ç›®æ¨™å¸‚å ´é¢¨éšª...</option>
                        <option value="600000">ğŸ‡ºğŸ‡¸ ç¾åœ‹ (ADA è¨´è¨Ÿé¢¨éšª ~2è¬ç¾é‡‘)</option>
                        <option value="3300000">ğŸ‡ªğŸ‡º æ­ç›Ÿ (EAA ç½°é°ä¸Šé™é¢¨éšª ~10è¬æ­å…ƒ)</option>
                        <option value="1">ğŸ‡¹ğŸ‡¼ å°ç£ (å…¬éƒ¨é–€æ¨™æ¡ˆè³‡æ ¼å–ªå¤±)</option>
                    </select>
                </div>
                <div id="wcagPlaceholder" class="text-xs text-slate-400 italic">
                    é–‹å•Ÿæ­¤é¸é …ä»¥è©•ä¼°æ½›åœ¨æ³•å¾‹ç½°æ¬¾èˆ‡å¸‚å ´æå¤±ã€‚
                </div>
            </div>

            <!-- Logic Explanation -->
            <div class="bg-white p-5 rounded-xl border border-slate-200 shadow-sm">
                <div class="flex justify-between items-center cursor-pointer group" onclick="toggleLogic()">
                    <h3 class="text-sm font-bold text-slate-700 flex items-center">
                        <i class="fas fa-book-open mr-2 text-slate-400 group-hover:text-blue-500 transition-colors"></i> 
                        è¨ˆç®—é‚è¼¯è©³è§£
                    </h3>
                    <div class="bg-slate-50 p-1 rounded-full border border-slate-200 shadow-sm group-hover:border-blue-300 transition-colors">
                        <i class="fas fa-chevron-down text-slate-400 text-xs transform transition-transform duration-300" id="logicIcon"></i>
                    </div>
                </div>
                
                <div id="logicContent" class="hidden mt-4 space-y-4 text-xs text-slate-600 leading-relaxed border-t border-slate-200 pt-4">
                    <!-- Logic 1 -->
                    <div>
                        <h4 class="font-bold text-slate-800 mb-1 flex items-center">
                            <span class="w-4 h-4 bg-blue-600 text-white rounded-full flex items-center justify-center text-[10px] mr-2">1</span>
                            çœŸå¯¦äººåŠ›æˆæœ¬ (Fully Loaded Cost)
                        </h4>
                        <p class="pl-6 mb-2">å…¬å¼ï¼š<code class="bg-slate-100 px-1 rounded text-slate-800">(æœˆè–ª Ã— å¹´è–ªæœˆæ•¸ Ã· 12) Ã— 1.5 Ã· 160å°æ™‚</code></p>
                        <p class="pl-6 text-slate-500 mb-2">
                            <strong>å¹´çµ‚æ”¤æï¼š</strong> å°‡å¹´è–ªç¸½é¡ï¼ˆå«13æˆ–14å€‹æœˆï¼‰æ”¤æè‡³æ¯æœˆï¼Œåæ˜ çœŸå¯¦æœˆæ”¯å‡ºã€‚
                        </p>
                        <p class="pl-6 text-slate-500">
                            <strong>1.5å€ç‡Ÿé‹ä¿‚æ•¸ï¼š</strong> æ¶µè“‹å‹å¥ä¿(ç´„20%)ã€é€€ä¼‘é‡‘(6%)ã€è¾¦å…¬å®¤ç§Ÿé‡‘ã€è»Ÿé«”æˆæ¬Š(Adobe/Figma)ã€ç¡¬é«”æŠ˜èˆŠèˆ‡ç®¡ç†è²»ã€‚
                        </p>
                    </div>

                    <!-- Logic 2 -->
                    <div>
                        <h4 class="font-bold text-slate-800 mb-1 flex items-center">
                            <span class="w-4 h-4 bg-orange-500 text-white rounded-full flex items-center justify-center text-[10px] mr-2">2</span>
                            è²»ç±³æ¨å®šï¼šæ•ˆç‡æµªè²»
                        </h4>
                        <ul class="pl-6 list-disc list-outside space-y-1 text-slate-500">
                            <li><strong>è¨­è¨ˆç«¯ï¼š</strong> åœ¨æ··äº‚çš„æª”æ¡ˆå¤¾ä¸­å°‹æ‰¾ã€é‡è¤‡ç¹ªè£½å·²å­˜åœ¨çš„æŒ‰éˆ•ã€è™•ç†ç‹€æ…‹ä¸ä¸€è‡´ã€‚</li>
                            <li><strong>é–‹ç™¼ç«¯ï¼š</strong> æ¸¬é‡åƒç´ (Pixel-peeping)ã€çŒœæ¸¬è¨­è¨ˆæ„åœ–ã€æ’°å¯«é‡è¤‡çš„ CSS Overrideã€‚</li>
                        </ul>
                    </div>

                    <!-- Logic 3 -->
                    <div>
                        <h4 class="font-bold text-slate-800 mb-1 flex items-center">
                            <span class="w-4 h-4 bg-red-500 text-white rounded-full flex items-center justify-center text-[10px] mr-2">3</span>
                            é¢¨éšªä¼°å€¼ (Risk Assessment)
                        </h4>
                        <p class="pl-6 text-slate-500">
                            <strong>åˆè¦é¢¨éšªï¼š</strong> ä¾æ“šåœ‹éš›è¨´è¨Ÿæ¡ˆä¾‹ï¼ˆADAï¼‰èˆ‡ç½°æ¬¾ä¸Šé™ï¼ˆEAAï¼‰è¨­å®šçš„æ½›åœ¨é¢¨éšªæ•å£ã€‚é€™ä¸¦éå›ºå®šæˆæœ¬ï¼Œè€Œæ˜¯ã€Œä¸è™•ç†å°±æœƒé¢è‡¨ã€çš„é æœŸæå¤±ã€‚
                        </p>
                    </div>
                </div>
            </div>

        </div>

        <!-- Footer / Action -->
        <div class="p-5 border-t border-slate-200 bg-white z-10">
            <button onclick="calculate()" class="w-full bg-slate-800 hover:bg-slate-700 text-white font-bold py-4 px-4 rounded-xl shadow-lg transition-all flex items-center justify-center group">
                <span>è¨ˆç®—ç¸½é«”ç‡Ÿé‹è¡æ“Š</span>
                <i class="fas fa-arrow-right ml-2 group-hover:translate-x-1 transition-transform"></i>
            </button>
        </div>
    </div>

    <!-- RESULT MODAL (Popup) -->
    <div id="resultModal" class="fixed inset-0 bg-slate-900/80 flex items-center justify-center z-50 hidden backdrop-blur-sm transition-opacity opacity-0 p-5">
        <div class="bg-white w-full max-w-2xl rounded-3xl p-6 shadow-2xl transform scale-95 transition-transform duration-300 max-h-[90vh] overflow-y-auto relative" id="modalContent">
            
            <!-- Modal Header -->
            <div class="flex justify-between items-start mb-4">
                <div>
                    <h2 class="text-slate-500 text-xs font-bold uppercase tracking-widest">å¹´åº¦é ä¼°ç¸½è¡æ“Š</h2>
                    <p class="text-[10px] text-slate-400">æ•ˆç‡è€—æ (OpEx) + æ½›åœ¨åˆè¦é¢¨éšª (Risk)</p>
                </div>
                <button onclick="closeModal()" class="text-slate-400 hover:text-slate-600"><i class="fas fa-times text-xl"></i></button>
            </div>

            <!-- SLOT MACHINE RESULT (Red + Negative) -->
            <div class="text-5xl font-black text-red-600 mb-8 tracking-tight h-12 overflow-hidden" id="finalResultContainer">
                -$0
            </div>

            <!-- Opportunity Cost Slider Section -->
            <div class="mb-6 relative group">
                <div class="absolute inset-0 bg-blue-50 rounded-xl transform -rotate-1 opacity-50"></div>
                <div class="relative bg-white border border-blue-100 rounded-xl p-4 shadow-sm">
                    <div class="flex justify-between items-center mb-3">
                        <h3 class="text-xs font-bold text-blue-800 uppercase tracking-wide flex items-center">
                            <i class="fas fa-search-dollar mr-1.5"></i> é€™ç­†éŒ¢åŸæœ¬å¯ä»¥æ‹¿ä¾†...
                        </h3>
                        <div class="text-blue-300 text-xs flex items-center">
                            æ»‘å‹•æŸ¥çœ‹
                        </div>
                    </div>
                    
                    <!-- Scrollable Container -->
                    <div class="flex overflow-x-auto hide-scrollbar gap-3 pb-2 snap-x snap-mandatory items-stretch" id="opportunitySlider">
                        <!-- Items will be injected by JS -->
                    </div>
                </div>
            </div>
            
            <!-- Breakdown & Markdown Details -->
            <div class="space-y-3 mb-6 border-t border-slate-100 pt-4">
                <h4 class="text-[10px] font-bold text-slate-400 uppercase">æå¤±ç´°é …</h4>
                <!-- Efficiency -->
                <div class="bg-slate-50 rounded-lg p-3">
                    <div class="flex justify-between items-center text-xs cursor-pointer" onclick="toggleEfficiencyDetails()">
                        <div class="flex items-center text-slate-700 font-bold">
                            <i class="fas fa-hourglass-half text-orange-400 w-5 text-center mr-2"></i>æ•ˆç‡æµªè²»
                        </div>
                        <div class="flex items-center">
                            <span class="font-bold text-slate-700 mr-2" id="efficiencyResult">$0</span>
                            <i class="fas fa-chevron-down text-slate-400 transition-transform" id="effDetailsIcon"></i>
                        </div>
                    </div>
                    <!-- Dynamic Markdown Content Container -->
                    <div id="efficiencyDetailsContent" class="hidden mt-3 pt-3 border-t border-slate-200 text-xs text-slate-600">
                        <div class="table-container prose prose-sm max-w-none">
                            <!-- Content injected by JS -->
                            è¼‰å…¥èªªæ˜ä¸­...
                        </div>
                    </div>
                </div>

                <!-- Risk -->
                <div id="riskBreakdown" class="hidden flex justify-between items-center text-xs p-3">
                    <div class="flex items-center text-slate-600">
                        <i class="fas fa-gavel text-red-400 w-5 text-center mr-2"></i>åˆè¦é¢¨éšª
                    </div>
                    <div class="font-bold text-red-600" id="riskResult">$0</div>
                </div>
            </div>

            <button onclick="closeModal()" class="w-full bg-slate-900 text-white font-bold py-3.5 rounded-xl hover:bg-slate-800 transition shadow-lg">
                é—œé–‰ä¸¦èª¿æ•´ç­–ç•¥
            </button>
        </div>
    </div>

    <script>
        // --- UPDATED DEFAULT MARKDOWN CONTENT (With full table) ---
        const defaultMarkdown = `
# è¨­è¨ˆå‚µå°å·¥ç¨‹é–‹ç™¼æ•ˆç‡ä¹‹å½±éŸ¿åˆ†æ

æ­¤è¡¨ç›¤é»äº†ç›®å‰çš„è¨­è¨ˆå‚µå¦‚ä½•å…·é«”è½‰åŒ–ç‚ºå·¥ç¨‹åœ˜éšŠçš„é–‹ç™¼æˆæœ¬èˆ‡æ•ˆç‡æè€—ã€‚

| å½±éŸ¿é¡åˆ¥ | é—œè¯è¨­è¨ˆå‚µ | å·¥ç¨‹å½±éŸ¿æ ¸å¿ƒ | å…·é«”å¾Œæœèˆ‡ç¾è±¡ | ğŸ’° æˆæœ¬æµªè²» |
| :--- | :--- | :--- | :--- | :--- |
| **1. é‡è¤‡é€ è¼ªå­**<br>*(Development Waste)* | â€¢ 1-1 ç„¡å…±ç”¨å…ƒä»¶<br>â€¢ 1-3 å¸¸ç”¨æ¨¡å¼æœªæ”¶éŒ„ | **å¾ã€Œçµ„è£ç©æœ¨ã€é€€åŒ–ç‚ºã€Œæ‰‹å·¥é›•åˆ»ã€**<br>é•å DRY (Don't Repeat Yourself) åŸå‰‡ã€‚ | â€¢ **æ•ˆç‡ä½è½**ï¼šç„¡æ³•ç›´æ¥ Importï¼Œé–‹ç™¼ç°¡å–®è¡¨å–®æ™‚é–“å¾ 30 åˆ†é˜æš´å¢è‡³ 3 å°æ™‚ã€‚<br>â€¢ **ä»£ç¢¼å†—é¤˜**ï¼šå°ˆæ¡ˆå……æ–¥å¹¾åå€‹ã€Œä¼¼æ˜¯è€Œéã€çš„é‡è¤‡çµ„ä»¶ã€‚<br>â€¢ **æ•ˆèƒ½éš±æ†‚**ï¼šç¼ºä¹å®˜æ–¹çµ„ä»¶å°è‡´å¼•å…¥å¤šé¤˜ç¬¬ä¸‰æ–¹å¥—ä»¶ï¼Œé€ æˆ Bundle size è†¨è„¹ã€‚ | **ç´”é–‹ç™¼å·¥æ™‚ (Man-hours)**<br>é«˜åƒ¹å€¼çš„æ ¸å¿ƒé‚è¼¯é–‹ç™¼æ™‚é–“ï¼Œè¢«æµªè²»åœ¨ä½åƒ¹å€¼çš„é‡è¤‡åˆ‡ç‰ˆä¸Šã€‚ |
| **2. ç„¡æ•ˆæºé€šèˆ‡ç¢ºèª**<br>*(Communication Overhead)* | â€¢ 2-1 Figma çµæ§‹æ··äº‚<br>â€¢ 2-2 ç„¡ Handoff Checklist | **ä¸­æ–·ã€Œå¿ƒæµ (Flow)ã€èˆ‡ä¸Šä¸‹æ–‡åˆ‡æ›**<br>å·¥ç¨‹å¸«æ·ªç‚ºã€Œæ‰¾æª”æ¡ˆã€èˆ‡ã€ŒçŒœè¬ã€çš„æ©Ÿå™¨ã€‚ | â€¢ **å°‹å¯¶éŠæˆ²**ï¼šåœ¨ v1/v2/Final ä¸­è¿·èˆªï¼Œæˆªåœ–å•ã€Œå“ªå€‹æ˜¯æº–çš„ï¼Ÿã€ã€‚<br>â€¢ **çŒœè¬éŠæˆ²**ï¼šç¼ºä¹ RWD/ç‹€æ…‹æ¨™è¨»ï¼Œå·¥ç¨‹å¸«é ç›´è¦ºçŒœæ¸¬å°è‡´ Bugã€‚<br>â€¢ **å°ˆæ³¨åŠ›æ­¸é›¶**ï¼šæ¯æ¬¡ç¢ºèªè¦æ ¼è¢«æ‰“æ–·ï¼Œéœ€ 23 åˆ†é˜æ‰èƒ½é‡å›ç·¨ç¢¼ç‹€æ…‹ã€‚ | **æºé€šæˆæœ¬ & èªçŸ¥è² è·**<br>å·¥ç¨‹å¸«æƒ…ç·’ç…©èºã€æ»¿æ„åº¦ä¸‹é™ï¼Œå°è‡´éš±æ€§æ€ å·¥ã€‚ |
| **3. é‡å·¥èˆ‡ä¿®è£œ**<br>*(Cost of Rework)* | â€¢ 1-2 è·¨å¹³å°ä¸ä¸€è‡´<br>â€¢ 3-1 A11y ç¼ºå¤± | **å°‡ã€Œé–‹ç™¼éšæ®µã€å•é¡Œå»¶å¾Œåˆ°ã€ŒQA/ç¶­é‹ã€çˆ†ç™¼**<br>è¶Šæ™šç™¼ç¾ Bugï¼Œä¿®å¾©æˆæœ¬è¶Šé«˜ã€‚ | â€¢ **é‚è¼¯åˆ†è£‚**ï¼šå› å¹³å°å·®ç•°å¯«å¤§é‡ \`if (isMobile)\`ï¼Œè£½é€  Bug æº«åºŠã€‚<br>â€¢ **å‚µå‹™åˆ©æ¯**ï¼šä¸Šç·šå¾Œè£œåš A11yï¼Œæˆæœ¬æ˜¯é–‹ç™¼æ™‚çš„ 10 å€ï¼ˆéœ€é‡æ§‹ DOMï¼‰ã€‚<br>â€¢ **ä¾†å›æ‹‰æ‰¯**ï¼šTicket åœ¨ QA/RD/Design ä¹‹é–“ç„¡é™ Ping-Pongï¼Œç„¡æ³•çµæ¡ˆã€‚ | **é‡æ§‹æˆæœ¬ & QA å¾ªç’°æˆæœ¬**<br>å¤§é‡è³‡æºæ¶ˆè€—åœ¨ä¿®å¾©æœ¬å¯é¿å…çš„éŒ¯èª¤ä¸Šã€‚ |
| **4. ç¶­è­·èˆ‡æ“´å……å›°é›£**<br>*(Scalability Issues)* | â€¢ 1-1 ç„¡ Token åŒ–<br>â€¢ 3-2 Wording ä¸çµ±ä¸€ | **ç³»çµ±è®Šå¾—ã€Œè„†å¼± (Fragile)ã€ä¸”é›£ä»¥ä¿®æ”¹**<br>ä»»ä½•å…¨åŸŸä¿®æ”¹éƒ½åƒåœ¨æ‹†å½ˆã€‚ | â€¢ **å…¨åŸŸä¿®æ”¹ææ‡¼**ï¼šæ”¹å“ç‰Œè‰²éœ€æ‰‹å‹•æ›¿æ›å¹¾åƒå€‹è‰²ç¢¼ï¼Œæ¥µæ˜“æ”¹éŒ¯é€ æˆäº‹æ•…ã€‚<br>â€¢ **ç¡¬ç·¨ç¢¼è©›å’’**ï¼šæ–‡æ¡ˆç„¡ Pattern å°è‡´ Hard-codeï¼Œä¿®æ”¹æ–‡æ¡ˆéœ€å‹• Code ä¸¦é‡æ–°éƒ¨ç½² (Deploy)ã€‚ | **ç¶­é‹æˆæœ¬ & æ©Ÿæœƒæˆæœ¬**<br>åœ˜éšŠè¢«èˆŠä»£ç¢¼ç¶æ¶ï¼Œç„¡æ³•å¿«é€ŸéŸ¿æ‡‰å¸‚å ´æ–°éœ€æ±‚ã€‚ |
`;

        // --- LOAD MARKDOWN ---
        async function loadMarkdown() {
            const container = document.querySelector('#efficiencyDetailsContent .table-container');
            try {
                // Try fetching external file first
                const response = await fetch('efficiency_loss.md');
                if (response.ok) {
                    const text = await response.text();
                    container.innerHTML = marked.parse(text);
                } else {
                    // Fallback to internal const
                    container.innerHTML = marked.parse(defaultMarkdown);
                    console.log("Using default markdown due to fetch failure");
                }
            } catch (e) {
                container.innerHTML = marked.parse(defaultMarkdown);
            }
        }

        function toggleEfficiencyDetails() {
            const content = document.getElementById('efficiencyDetailsContent');
            const icon = document.getElementById('effDetailsIcon');
            if (content.classList.contains('hidden')) {
                content.classList.remove('hidden');
                icon.classList.add('rotate-180');
                if(content.innerText.includes("è¼‰å…¥èªªæ˜ä¸­")) {
                    loadMarkdown();
                }
            } else {
                content.classList.add('hidden');
                icon.classList.remove('rotate-180');
            }
        }

        // --- LOGIC TOGGLES ---
        function toggleLogic() {
            const content = document.getElementById('logicContent');
            const icon = document.getElementById('logicIcon');
            if (content.classList.contains('hidden')) {
                content.classList.remove('hidden');
                setTimeout(() => icon.classList.add('rotate-180'), 10);
            } else {
                content.classList.add('hidden');
                icon.classList.remove('rotate-180');
            }
        }

        function toggleWcagOptions() {
            const toggle = document.getElementById('wcagToggle');
            const options = document.getElementById('wcagOptions');
            const placeholder = document.getElementById('wcagPlaceholder');
            if (toggle.checked) {
                options.classList.remove('hidden');
                placeholder.classList.add('hidden');
            } else {
                options.classList.add('hidden');
                placeholder.classList.remove('hidden');
                document.getElementById('riskRegion').value = "0"; 
            }
        }

        // --- SLOT MACHINE ANIMATION ENGINE ---
        function runSlotMachineAnimation(container, finalValue) {
            const formattedString = "-" + new Intl.NumberFormat('zh-TW', { 
                style: 'currency', 
                currency: 'TWD', 
                maximumFractionDigits: 0 
            }).format(finalValue);

            container.innerHTML = '';
            container.classList.add('slot-machine-wrapper');

            const chars = formattedString.split('');
            let digitIndex = 0;

            chars.forEach((char, index) => {
                if (/\d/.test(char)) {
                    const windowDiv = document.createElement('div');
                    windowDiv.className = 'slot-digit-window';
                    const strip = document.createElement('div');
                    strip.className = 'slot-strip';
                    let numbersHTML = '';
                    for (let set = 0; set < 3; set++) {
                        for (let i = 0; i <= 9; i++) {
                            numbersHTML += `<div class="slot-num">${i}</div>`;
                        }
                    }
                    strip.innerHTML = numbersHTML;
                    windowDiv.appendChild(strip);
                    container.appendChild(windowDiv);

                    const targetVal = parseInt(char);
                    const targetIndex = 20 + targetVal; 
                    const delay = digitIndex * 150; 
                    const duration = 1500;
                    
                    void strip.offsetWidth;

                    setTimeout(() => {
                        strip.style.transitionDuration = `${duration}ms`;
                        strip.style.transitionDelay = `${delay}ms`;
                        strip.style.transform = `translateY(-${targetIndex}em)`;
                    }, 50);

                    digitIndex++;
                } else {
                    const span = document.createElement('span');
                    span.textContent = char;
                    container.appendChild(span);
                }
            });
        }

        // --- CUSTOM CARD CALCULATION ---
        function calcCustomCard() {
            const nameInput = document.getElementById('customName');
            const priceInput = document.getElementById('customPrice');
            const resultDisplay = document.getElementById('customResult');
            const resultUnit = document.getElementById('customUnitDisplay');
            
            const totalImpact = parseFloat(document.getElementById('resultModal').getAttribute('data-total-impact')) || 0;
            const price = parseFloat(priceInput.value);
            const name = nameInput.value || 'è‡ªè¨‚é …ç›®';

            if (price > 0 && totalImpact > 0) {
                const count = Math.floor(totalImpact / price);
                resultDisplay.innerText = count.toLocaleString();
                resultUnit.innerText = "å€‹"; 
            } else {
                resultDisplay.innerText = "-";
            }
        }

        // --- RENDER OPPORTUNITY SLIDER ---
        function renderOpportunitySlider(totalImpact, personAnnualCost) {
            const container = document.getElementById('opportunitySlider');
            container.innerHTML = ''; 

            const items = [
                {
                    icon: 'fa-user-plus', color: 'blue', title: 'å¢è˜è³‡æ·±æˆ°åŠ›', unit: 'äºº',
                    val: (totalImpact / (personAnnualCost * 1.1)).toFixed(1)
                },
                {
                    icon: 'fa-laptop', color: 'gray', title: 'é ‚è¦ MacBook Pro', unit: 'å°',
                    val: Math.floor(totalImpact / 80000).toLocaleString()
                },
                {
                    icon: 'fa-chair', color: 'teal', title: 'Herman Miller æ¤…', unit: 'å¼µ',
                    val: Math.floor(totalImpact / 40000).toLocaleString()
                },
                {
                    icon: 'fa-utensils', color: 'orange', title: 'ç±³å…¶æ—éƒ¨é–€èšé¤', unit: 'å ´',
                    val: Math.floor(totalImpact / (5000 * 10)).toLocaleString() 
                },
                {
                    icon: 'fa-file-invoice-dollar', color: 'purple', title: 'Figma ä¼æ¥­ç‰ˆå¹´è²»', unit: 'å¹´',
                    val: (totalImpact / (10 * 75 * 12 * 32)).toFixed(1)
                },
                {
                    icon: 'fa-car', color: 'red', title: 'Tesla Model 3', unit: 'è¼›',
                    val: (totalImpact / 1700000).toFixed(1)
                },
                {
                    icon: 'fa-palette', color: 'pink', title: 'å¥ˆè‰¯ç¾æ™º(Yoshitomo)ç‰ˆç•«', unit: 'å¹…',
                    val: Math.floor(totalImpact / 150000).toLocaleString()
                }
            ];

            items.forEach(item => {
                const card = document.createElement('div');
                card.className = `flex-none min-w-[140px] bg-${item.color}-50 rounded-lg p-3 text-center border border-${item.color}-100 snap-center flex flex-col justify-center`;
                card.innerHTML = `
                    <i class="fas ${item.icon} text-${item.color}-500 text-lg mb-1"></i>
                    <div class="text-[10px] text-slate-500 font-medium mb-0.5 whitespace-normal leading-tight h-8 flex items-center justify-center">${item.title}</div>
                    <div class="text-sm font-bold text-${item.color}-700">
                        ${item.val} <span class="text-xs font-normal">${item.unit}</span>
                    </div>
                `;
                container.appendChild(card);
            });

            // Custom Card
            const customCard = document.createElement('div');
            customCard.className = `flex-none min-w-[160px] bg-white rounded-lg p-2 text-center border-2 border-dashed border-slate-300 snap-center flex flex-col justify-center`;
            customCard.innerHTML = `
                <div class="text-[10px] text-slate-400 font-bold mb-2 uppercase">è‡ªè¨‚æ›ç®—</div>
                <div class="space-y-1 mb-2">
                    <input type="text" id="customName" placeholder="é …ç›® (ä¾‹: ä¼ºæœå™¨)" class="w-full text-[10px] border border-slate-200 rounded px-1 py-1 text-center bg-slate-50 focus:outline-none focus:border-blue-400">
                    <input type="number" id="customPrice" placeholder="å–®åƒ¹ (ä¾‹: 50000)" class="w-full text-[10px] border border-slate-200 rounded px-1 py-1 text-center bg-slate-50 focus:outline-none focus:border-blue-400" oninput="calcCustomCard()">
                </div>
                <div class="text-sm font-bold text-slate-700 bg-slate-100 rounded py-1">
                    <span id="customResult">-</span> <span id="customUnitDisplay" class="text-xs font-normal"></span>
                </div>
            `;
            container.appendChild(customCard);
        }

        // --- MAIN CALCULATE ---
        function calculate() {
            const salary = parseFloat(document.getElementById('salary').value) || 0;
            const months = parseFloat(document.querySelector('input[name="months"]:checked').value);
            const nDes = parseFloat(document.getElementById('nDes').value) || 0;
            const tDes = parseFloat(document.getElementById('tDes').value) || 0;
            const nDev = parseFloat(document.getElementById('nDev').value) || 0;
            const tDev = parseFloat(document.getElementById('tDev').value) || 0;
            const riskValue = parseFloat(document.getElementById('riskRegion').value) || 0;

            const multiplier = 1.5; 
            const workDays = 250;
            const hoursPerMonth = 160;

            const annualSalaryPackage = salary * months;
            const monthlyAvg = annualSalaryPackage / 12;
            const hourlyCost = (monthlyAvg * multiplier) / hoursPerMonth;
            const personAnnualCost = annualSalaryPackage * multiplier;

            const desAnnualHours = nDes * tDes * workDays;
            const devAnnualHours = nDev * tDev * workDays;
            const efficiencyLoss = (desAnnualHours + devAnnualHours) * hourlyCost;

            let finalRiskCost = riskValue;
            if (riskValue === 1) finalRiskCost = 0; 
            const totalImpact = efficiencyLoss + finalRiskCost;

            document.getElementById('resultModal').setAttribute('data-total-impact', totalImpact);

            const resultContainer = document.getElementById('finalResultContainer');
            runSlotMachineAnimation(resultContainer, totalImpact);

            document.getElementById('efficiencyResult').innerText = formatCurrency(efficiencyLoss);

            renderOpportunitySlider(totalImpact, personAnnualCost);

            const riskEl = document.getElementById('riskBreakdown');
            const riskRes = document.getElementById('riskResult');
            
            if (document.getElementById('wcagToggle').checked && riskValue > 0) {
                riskEl.classList.remove('hidden');
                if (riskValue === 1) {
                    riskRes.innerText = "æ¨™æ¡ˆè³‡æ ¼å–ªå¤±";
                    riskRes.className = "font-bold text-red-600";
                } else {
                    riskRes.innerText = formatCurrency(riskValue);
                    riskRes.className = "font-bold text-red-600";
                }
            } else {
                riskEl.classList.add('hidden');
            }

            const modal = document.getElementById('resultModal');
            const modalContent = document.getElementById('modalContent');
            
            modal.classList.remove('hidden');
            void modal.offsetWidth;
            modal.classList.remove('opacity-0');
            modalContent.classList.remove('scale-95');
            modalContent.classList.add('scale-100');
        }

        function closeModal() {
            const modal = document.getElementById('resultModal');
            const modalContent = document.getElementById('modalContent');
            modal.classList.add('opacity-0');
            modalContent.classList.remove('scale-100');
            modalContent.classList.add('scale-95');
            setTimeout(() => {
                modal.classList.add('hidden');
            }, 300);
        }

        function formatCurrency(num) {
            return new Intl.NumberFormat('zh-TW', { 
                style: 'currency', 
                currency: 'TWD', 
                maximumFractionDigits: 0 
            }).format(num);
        }
    </script>
</body>
</html>