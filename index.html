<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>設計治理與合規風險試算 V7</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background-color: #f0f2f5; }
        .card-shadow { box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04); }
        .gradient-bg { background: linear-gradient(135deg, #0f172a 0%, #334155 100%); } /* Darker professional look */
        .risk-gradient { background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%); }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

    <div class="bg-white w-full max-w-lg rounded-3xl card-shadow overflow-hidden flex flex-col h-[90vh]">
        
        <!-- Header -->
        <div class="gradient-bg p-6 text-white text-center flex-shrink-0 relative overflow-hidden">
            <div class="absolute top-0 right-0 p-4 opacity-10"><i class="fas fa-balance-scale text-6xl"></i></div>
            <h1 class="text-2xl font-bold mb-1 tracking-wide">設計治理與風險試算</h1>
            <p class="text-slate-300 text-xs uppercase tracking-wider font-semibold">Efficiency Loss + Compliance Risk</p>
        </div>

        <!-- Scrollable Content -->
        <div class="p-6 space-y-5 overflow-y-auto flex-grow bg-slate-50">
            
            <!-- Section 1: Basic Cost -->
            <div class="bg-white rounded-xl border border-slate-200 p-4 shadow-sm">
                <div class="flex items-center text-slate-800 font-bold border-b border-slate-100 pb-2 mb-3">
                    <i class="fas fa-coins text-blue-600 mr-2"></i>
                    <span>基礎人力成本</span>
                </div>
                <div class="space-y-3">
                    <div>
                        <label class="text-xs text-slate-500 font-bold uppercase block mb-1">平均月薪 (TWD)</label>
                        <input type="number" id="salary" value="70000" class="w-full bg-slate-50 border border-slate-300 rounded-lg p-2 font-semibold text-slate-700 focus:ring-2 focus:ring-blue-500 outline-none">
                    </div>
                    <div>
                        <label class="text-xs text-slate-500 font-bold uppercase block mb-1">年薪月數 (含年終)</label>
                        <div class="flex space-x-2">
                            <label class="flex-1 cursor-pointer"><input type="radio" name="months" value="13" class="peer sr-only"><div class="text-center text-xs py-2 border rounded-md peer-checked:bg-blue-600 peer-checked:text-white transition">13個月</div></label>
                            <label class="flex-1 cursor-pointer"><input type="radio" name="months" value="14" class="peer sr-only" checked><div class="text-center text-xs py-2 border rounded-md peer-checked:bg-blue-600 peer-checked:text-white transition">14個月</div></label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Section 2: Efficiency Loss -->
            <div class="bg-white rounded-xl border border-slate-200 p-4 shadow-sm relative group">
                <div class="absolute -left-1 top-4 w-1 h-12 bg-orange-400 rounded-r"></div>
                <div class="flex items-center text-slate-800 font-bold border-b border-slate-100 pb-2 mb-3">
                    <i class="fas fa-stopwatch text-orange-500 mr-2"></i>
                    <span>治理缺失：效率耗損</span>
                </div>
                
                <!-- Designer -->
                <div class="mb-4 pb-4 border-b border-slate-50 last:border-0 last:pb-0">
                    <div class="flex justify-between items-center mb-2">
                        <label class="text-xs font-bold text-slate-700 flex items-center">
                            <i class="fas fa-pen-nib text-slate-400 mr-1.5 text-[10px]"></i>設計師
                        </label>
                        <span class="text-[10px] text-orange-600 bg-orange-50 px-2 py-0.5 rounded-full border border-orange-100">痛點：無 SSOT / 狀態混亂</span>
                    </div>
                    <div class="flex gap-3">
                        <div class="flex-1">
                            <label class="text-[10px] text-slate-400 block mb-1 uppercase tracking-wide font-semibold">團隊人數</label>
                            <div class="relative">
                                <input type="number" id="nDes" value="5" class="w-full border border-slate-300 rounded-lg p-2 text-sm font-bold text-slate-700 focus:ring-2 focus:ring-blue-500 outline-none">
                                <span class="absolute right-3 top-2 text-xs text-slate-400 pointer-events-none">人</span>
                            </div>
                        </div>
                        <div class="flex-1">
                            <label class="text-[10px] text-slate-400 block mb-1 uppercase tracking-wide font-semibold">每日浪費工時</label>
                            <div class="relative">
                                <input type="number" id="tDes" value="0.75" step="0.25" class="w-full border border-slate-300 rounded-lg p-2 text-sm font-bold text-slate-700 focus:ring-2 focus:ring-blue-500 outline-none bg-orange-50/30">
                                <span class="absolute right-3 top-2 text-xs text-slate-400 pointer-events-none">小時</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Developer -->
                <div>
                    <div class="flex justify-between items-center mb-2">
                        <label class="text-xs font-bold text-slate-700 flex items-center">
                            <i class="fas fa-code text-slate-400 mr-1.5 text-[10px]"></i>工程師
                        </label>
                        <span class="text-[10px] text-orange-600 bg-orange-50 px-2 py-0.5 rounded-full border border-orange-100">痛點：重複 Override / 猜測樣式</span>
                    </div>
                    <div class="flex gap-3">
                        <div class="flex-1">
                            <label class="text-[10px] text-slate-400 block mb-1 uppercase tracking-wide font-semibold">團隊人數</label>
                            <div class="relative">
                                <input type="number" id="nDev" value="3" class="w-full border border-slate-300 rounded-lg p-2 text-sm font-bold text-slate-700 focus:ring-2 focus:ring-blue-500 outline-none">
                                <span class="absolute right-3 top-2 text-xs text-slate-400 pointer-events-none">人</span>
                            </div>
                        </div>
                        <div class="flex-1">
                            <label class="text-[10px] text-slate-400 block mb-1 uppercase tracking-wide font-semibold">每日浪費工時</label>
                            <div class="relative">
                                <input type="number" id="tDev" value="0.5" step="0.25" class="w-full border border-slate-300 rounded-lg p-2 text-sm font-bold text-slate-700 focus:ring-2 focus:ring-blue-500 outline-none bg-orange-50/30">
                                <span class="absolute right-3 top-2 text-xs text-slate-400 pointer-events-none">小時</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Section 3: WCAG Risk -->
            <div class="bg-white rounded-xl border border-red-200 p-4 shadow-sm relative overflow-hidden">
                <div class="absolute -left-1 top-4 w-1 h-12 bg-red-500 rounded-r"></div>
                <div class="flex items-center justify-between border-b border-red-100 pb-2 mb-3">
                    <div class="font-bold text-slate-800 flex items-center">
                        <i class="fas fa-gavel text-red-500 mr-2"></i>
                        <span>法律與合規風險 (WCAG)</span>
                    </div>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" id="wcagToggle" class="sr-only peer" onchange="toggleWcagOptions()">
                        <div class="w-9 h-5 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-red-600"></div>
                    </label>
                </div>
                
                <div id="wcagOptions" class="hidden space-y-3 transition-all">
                    <p class="text-[10px] text-red-500 mb-2">
                        <i class="fas fa-exclamation-triangle"></i> 
                        2025/2026 EAA 與 ADA 強制執行，違規將面臨高額罰款。
                    </p>
                    <select id="riskRegion" class="w-full text-sm border-red-200 border rounded-lg p-2.5 bg-red-50 text-slate-700 focus:ring-red-500">
                        <option value="0">請選擇目標市場風險...</option>
                        <option value="600000">🇺🇸 美國 (ADA 訴訟風險 ~2萬美金)</option>
                        <option value="3300000">🇪🇺 歐盟 (EAA 罰鍰上限風險 ~10萬歐元)</option>
                        <option value="1">🇹🇼 台灣 (公部門標案資格喪失)</option>
                    </select>
                </div>
                <div id="wcagPlaceholder" class="text-xs text-slate-400 italic">
                    開啟此選項以評估潛在法律罰款與市場損失。
                </div>
            </div>

            <!-- Detailed Calculation Logic Explanation -->
            <div class="bg-white p-5 rounded-xl border border-slate-200 shadow-sm">
                <div class="flex justify-between items-center cursor-pointer group" onclick="toggleLogic()">
                    <h3 class="text-sm font-bold text-slate-700 flex items-center">
                        <i class="fas fa-book-open mr-2 text-slate-400 group-hover:text-blue-500 transition-colors"></i> 
                        計算邏輯詳解
                    </h3>
                    <div class="bg-slate-50 p-1 rounded-full border border-slate-200 shadow-sm group-hover:border-blue-300 transition-colors">
                        <i class="fas fa-chevron-down text-slate-400 text-xs transform transition-transform duration-300" id="logicIcon"></i>
                    </div>
                </div>
                
                <div id="logicContent" class="hidden mt-4 space-y-4 text-xs text-slate-600 leading-relaxed border-t border-slate-200 pt-4">
                    
                    <!-- Logic 1 -->
                    <div>
                        <h4 class="font-bold text-slate-800 mb-1 flex items-center">
                            <span class="w-4 h-4 bg-blue-600 text-white rounded-full flex items-center justify-center text-[10px] mr-2">1</span>
                            真實人力成本 (Fully Loaded Cost)
                        </h4>
                        <p class="pl-6 mb-2">
                            公式：<code class="bg-slate-100 px-1 rounded text-slate-800">(月薪 × 年薪月數 ÷ 12) × 1.5 ÷ 160小時</code>
                        </p>
                        <p class="pl-6 text-slate-500 mb-2">
                            <strong>年終攤提：</strong> 將年薪總額（含13或14個月）攤提至每月，反映真實月支出。
                        </p>
                        <p class="pl-6 text-slate-500">
                            <strong>1.5倍營運係數：</strong> 涵蓋勞健保(約20%)、退休金(6%)、辦公室租金、軟體授權(Adobe/Figma)、硬體折舊與管理費。
                        </p>
                    </div>

                    <!-- Logic 2 -->
                    <div>
                        <h4 class="font-bold text-slate-800 mb-1 flex items-center">
                            <span class="w-4 h-4 bg-orange-500 text-white rounded-full flex items-center justify-center text-[10px] mr-2">2</span>
                            費米推定：效率浪費
                        </h4>
                        <ul class="pl-6 list-disc list-outside space-y-1 text-slate-500">
                            <li><strong>設計端：</strong> 在混亂的檔案夾中尋找、重複繪製已存在的按鈕、處理狀態不一致。</li>
                            <li><strong>開發端：</strong> 測量像素(Pixel-peeping)、猜測設計意圖、撰寫重複的 CSS Override。</li>
                        </ul>
                    </div>

                    <!-- Logic 3 -->
                    <div>
                        <h4 class="font-bold text-slate-800 mb-1 flex items-center">
                            <span class="w-4 h-4 bg-red-500 text-white rounded-full flex items-center justify-center text-[10px] mr-2">3</span>
                            風險估值 (Risk Assessment)
                        </h4>
                        <p class="pl-6 text-slate-500">
                            <strong>合規風險：</strong> 依據國際訴訟案例（ADA）與罰款上限（EAA）設定的潛在風險敞口。這並非固定成本，而是「不處理就會面臨」的預期損失。
                        </p>
                    </div>

                </div>
            </div>

        </div>

        <!-- Footer / Action -->
        <div class="p-5 border-t border-slate-200 bg-white z-10">
            <button onclick="calculate()" class="w-full bg-slate-800 hover:bg-slate-700 text-white font-bold py-4 px-4 rounded-xl shadow-lg transition-all flex items-center justify-center group">
                <span>計算總體營運衝擊</span>
                <i class="fas fa-arrow-right ml-2 group-hover:translate-x-1 transition-transform"></i>
            </button>
        </div>
    </div>

    <!-- Result Modal -->
    <div id="resultModal" class="fixed inset-0 bg-slate-900/80 flex items-end sm:items-center justify-center z-50 hidden backdrop-blur-sm transition-opacity opacity-0">
        <div class="bg-white w-full max-w-sm sm:rounded-3xl rounded-t-3xl p-6 shadow-2xl transform scale-95 transition-transform duration-300 max-h-[90vh] overflow-y-auto" id="modalContent">
            
            <!-- Modal Header -->
            <div class="flex justify-between items-start mb-4">
                <div>
                    <h2 class="text-slate-500 text-xs font-bold uppercase tracking-widest">年度預估總衝擊</h2>
                    <p class="text-[10px] text-slate-400">效率耗損 (OpEx) + 潛在合規風險 (Risk)</p>
                </div>
                <button onclick="closeModal()" class="text-slate-400 hover:text-slate-600"><i class="fas fa-times text-xl"></i></button>
            </div>

            <!-- Big Result Number -->
            <div class="text-4xl font-black text-slate-800 mb-6 tracking-tight" id="finalResult">$0</div>

            <!-- Opportunity Cost (New Section) -->
            <div class="mb-6 relative">
                <div class="absolute inset-0 bg-blue-50 rounded-xl transform -rotate-1 opacity-50"></div>
                <div class="relative bg-white border border-blue-100 rounded-xl p-4 shadow-sm">
                    <h3 class="text-xs font-bold text-blue-800 uppercase tracking-wide mb-3 flex items-center">
                        <i class="fas fa-search-dollar mr-1.5"></i> 這筆錢原本可以拿來...
                    </h3>
                    <div class="grid grid-cols-2 gap-3">
                        <!-- Hiring -->
                        <div class="bg-blue-50 rounded-lg p-3 text-center border border-blue-100">
                            <i class="fas fa-user-plus text-blue-500 text-lg mb-1"></i>
                            <div class="text-[10px] text-slate-500 font-medium mb-0.5">增聘資深戰力</div>
                            <div class="text-sm font-bold text-blue-700">
                                <span id="hireCount">0</span> <span class="text-xs font-normal">人</span>
                            </div>
                        </div>
                        <!-- Hardware -->
                        <div class="bg-gray-100 rounded-lg p-3 text-center border border-gray-200">
                            <i class="fas fa-laptop text-gray-600 text-lg mb-1"></i>
                            <div class="text-[10px] text-slate-500 font-medium mb-0.5">買頂規 Mac</div>
                            <div class="text-sm font-bold text-gray-800">
                                <span id="macCount">0</span> <span class="text-xs font-normal">台</span>
                            </div>
                        </div>
                    </div>
                    <p class="text-[10px] text-slate-400 mt-2 text-center">
                        (約 <span id="engCount" class="font-medium text-slate-600">0</span> 位工程師 或 <span id="desCount" class="font-medium text-slate-600">0</span> 位設計師)
                    </p>
                </div>
            </div>
            
            <!-- Breakdown -->
            <div class="space-y-3 mb-6 border-t border-slate-100 pt-4">
                <h4 class="text-[10px] font-bold text-slate-400 uppercase">損失細項</h4>
                <!-- Efficiency -->
                <div class="flex justify-between items-center text-xs">
                    <div class="flex items-center text-slate-600">
                        <i class="fas fa-hourglass-half text-orange-400 w-5 text-center mr-2"></i>效率浪費
                    </div>
                    <div class="font-bold text-slate-700" id="efficiencyResult">$0</div>
                </div>

                <!-- Risk -->
                <div id="riskBreakdown" class="hidden flex justify-between items-center text-xs">
                    <div class="flex items-center text-slate-600">
                        <i class="fas fa-gavel text-red-400 w-5 text-center mr-2"></i>合規風險
                    </div>
                    <div class="font-bold text-red-600" id="riskResult">$0</div>
                </div>
            </div>

            <button onclick="closeModal()" class="w-full bg-slate-900 text-white font-bold py-3.5 rounded-xl hover:bg-slate-800 transition shadow-lg">
                關閉並調整策略
            </button>
        </div>
    </div>

    <script>
        // Logic Toggle Function
        function toggleLogic() {
            const content = document.getElementById('logicContent');
            const icon = document.getElementById('logicIcon');
            
            if (content.classList.contains('hidden')) {
                content.classList.remove('hidden');
                setTimeout(() => icon.classList.add('rotate-180'), 10);
            } else {
                content.classList.add('hidden');
                icon.classList.remove('rotate-180');
            }
        }

        function toggleWcagOptions() {
            const toggle = document.getElementById('wcagToggle');
            const options = document.getElementById('wcagOptions');
            const placeholder = document.getElementById('wcagPlaceholder');
            
            if (toggle.checked) {
                options.classList.remove('hidden');
                placeholder.classList.add('hidden');
            } else {
                options.classList.add('hidden');
                placeholder.classList.remove('hidden');
                document.getElementById('riskRegion').value = "0"; // Reset selection
            }
        }

        function calculate() {
            // Inputs
            const salary = parseFloat(document.getElementById('salary').value) || 0;
            const months = parseFloat(document.querySelector('input[name="months"]:checked').value);
            const nDes = parseFloat(document.getElementById('nDes').value) || 0;
            const tDes = parseFloat(document.getElementById('tDes').value) || 0;
            const nDev = parseFloat(document.getElementById('nDev').value) || 0;
            const tDev = parseFloat(document.getElementById('tDev').value) || 0;
            const riskValue = parseFloat(document.getElementById('riskRegion').value) || 0;

            // Constants
            const multiplier = 1.5; // Fully Loaded Cost
            const workDays = 250;
            const hoursPerMonth = 160;

            // 1. Calculate Hourly Cost
            // (Monthly Salary * Months / 12) * 1.5 / 160
            const annualSalaryPackage = salary * months;
            const monthlyAvg = annualSalaryPackage / 12;
            const hourlyCost = (monthlyAvg * multiplier) / hoursPerMonth;
            
            // Calculate Base Annual Fully Loaded Cost per person for Opportunity Cost
            const personAnnualCost = annualSalaryPackage * multiplier;

            // 2. Efficiency Loss Calculation
            const desAnnualHours = nDes * tDes * workDays;
            const devAnnualHours = nDev * tDev * workDays;
            const efficiencyLoss = (desAnnualHours + devAnnualHours) * hourlyCost;

            // 3. Total Risk
            let finalRiskCost = riskValue;
            if (riskValue === 1) finalRiskCost = 0; 

            const totalImpact = efficiencyLoss + finalRiskCost;

            // 4. Opportunity Cost Calculation
            // Assumptions: 
            // Senior Engineer = 1.1x Avg Fully Loaded Cost
            // Senior Designer = 0.9x Avg Fully Loaded Cost (relative to base)
            // MacBook Pro = 80,000 TWD
            const engCost = personAnnualCost * 1.1;
            const desCost = personAnnualCost * 0.9;
            const macbookCost = 80000;

            const hireEngCount = totalImpact / engCost;
            const hireDesCount = totalImpact / desCost;
            const macbookCount = totalImpact / macbookCost;

            // Update UI
            document.getElementById('finalResult').innerText = formatCurrency(totalImpact);
            document.getElementById('efficiencyResult').innerText = formatCurrency(efficiencyLoss);
            
            // Opportunity Cost UI
            document.getElementById('hireCount').innerText = hireEngCount.toFixed(1); // Use Eng count as primary display
            document.getElementById('engCount').innerText = hireEngCount.toFixed(1);
            document.getElementById('desCount').innerText = hireDesCount.toFixed(1);
            document.getElementById('macCount').innerText = Math.floor(macbookCount).toLocaleString();

            // Risk UI Logic
            const riskEl = document.getElementById('riskBreakdown');
            const riskRes = document.getElementById('riskResult');
            
            if (document.getElementById('wcagToggle').checked && riskValue > 0) {
                riskEl.classList.remove('hidden');
                if (riskValue === 1) {
                    riskRes.innerText = "標案資格喪失";
                    riskRes.className = "font-bold text-red-600";
                } else {
                    riskRes.innerText = formatCurrency(riskValue);
                    riskRes.className = "font-bold text-red-600";
                }
            } else {
                riskEl.classList.add('hidden');
            }

            // Show Modal
            const modal = document.getElementById('resultModal');
            const modalContent = document.getElementById('modalContent');
            
            modal.classList.remove('hidden');
            void modal.offsetWidth;
            modal.classList.remove('opacity-0');
            modalContent.classList.remove('scale-95');
            modalContent.classList.add('scale-100');
        }

        function closeModal() {
            const modal = document.getElementById('resultModal');
            const modalContent = document.getElementById('modalContent');
            
            modal.classList.add('opacity-0');
            modalContent.classList.remove('scale-100');
            modalContent.classList.add('scale-95');
            
            setTimeout(() => {
                modal.classList.add('hidden');
            }, 300);
        }

        function formatCurrency(num) {
            return new Intl.NumberFormat('zh-TW', { 
                style: 'currency', 
                currency: 'TWD', 
                maximumFractionDigits: 0 
            }).format(num);
        }
    </script>
</body>
</html>
